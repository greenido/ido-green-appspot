<!doctype html>
<!--[if lt IE 7]>
<html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en">
  <![endif]-->
  <!--[if IE 7]>
  <html class="no-js lt-ie9 lt-ie8" lang="en">
    <![endif]-->
    <!--[if IE 8]>
    <html class="no-js lt-ie9" lang="en">
      <![endif]-->
      <!--[if gt IE 8]>
      <!-->
      <html class="no-js" lang="en">
        <!--<![endif]-->
<head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

        <title>Cloud Endpoints Web Blog Post</title>
        <meta name="description" content="Brad Abrams and I had a great time doing this session: 'HTML5 and App Engine: The Epic Tag Team Take on Modern Web Apps at Scale' at Google I/O 2012.  Here is a little walkthrough on ‘how to built it’ from zero to hero in less then 60 minutes.">
        <meta name="author" content="Ido Green | greenido.wordpress.com | @greenido">
        <meta name="viewport" content="width=device-width,initial-scale=1">

        <link rel="stylesheet" href="../css/bootstrap.min.css">
        <link rel="stylesheet" href="../css/bootstrap-responsive.min.css">
        <link rel="stylesheet" href="../css/rssfeed.css">

        <link rel="stylesheet" href="../css/style.css">
        <link rel="stylesheet" href="../css/tipTip.css">

        <link rel="shortcut icon" href="../imgs/favicon.ico">
        <link rel="apple-touch-icon" href="../imgs/apple-touch-57x57.png">
        <link rel="apple-touch-icon" sizes="72x72" href="../imgs/apple-touch-72x72.png">
        <link rel="apple-touch-icon" sizes="114x114" href="../imgs/apple-touch-114x114.png">

        <script src="../js/libs/modernizr-2.5.3-respond-1.1.0.min.js"></script>
        <style type="text/css">
    img:not([width]):not([height]) {
      border: 2px solid red !important;
    }

    ol{margin:0;padding:0}.c11{color:#999988;font-size:9pt;font-style:italic;font-family:"Consolas"}.c0{font-size:9pt;background-color:#ffffff;font-family:"Consolas"}.c45{color:#3b81f1;font-size:15pt;font-family:"Open Sans"}.c42{list-style-type:circle;margin:0;padding:0}.c30{padding-left:0pt;text-align:justify;margin-left:46pt}.c9{padding-left:0pt;text-align:justify;margin-left:72pt}.c15{color:#333333;font-size:9pt;font-family:"Consolas"}.c25{font-size:10pt;background-color:#fafafa;font-family:"Verdana"}.c32{list-style-type:decimal;margin:0;padding:0}.c22{list-style-type:disc;margin:0;padding:0}.c46{max-width:468pt;padding:72pt 72pt 72pt 72pt}.c26{color:#008000;font-style:italic}.c18{color:#333333;background-color:#ffffff}.c12{padding-left:0pt;margin-left:37pt}.c14{padding-left:0pt;margin-left:36pt}.c43{color:#042550;font-size:10pt}.c19{color:#373737;background-color:#ffffff}.c48{padding-left:0pt;margin-left:92pt}.c5{font-size:10pt;font-family:"Courier New"}.c20{color:#1155cc;text-decoration:underline}.c13{color:inherit;text-decoration:inherit}.c23{font-size:9pt;font-family:"Consolas"}.c7{padding-left:0pt;margin-left:13pt}.c35{color:#042550;background-color:#f5f5f5}.c4{font-weight:bold}.c3{direction:ltr}.c51{color:#009999}.c10{color:#0000ff}.c27{background-color:#ffffff}.c1{color:#009900}.c47{color:#008800}.c17{color:#006633}.c28{font-style:italic}.c44{text-align:justify}.c49{background-color:#ff9900}.c24{color:#006699}.c37{color:#dd1144}.c6{height:11pt}.c40{color:#6611cc}.c29{font-size:14pt}.c41{color:#000088}.c33{color:#0088cc}.c21{color:#000066}.c31{color:#1982d1}.c39{color:#666666}.c36{color:#880000}.c16{color:#003399}.c50{color:#042550}.c8{font-family:"Courier New"}.c38{color:#cc66cc}.c34{text-align:center}.c2{color:#339933}.title{padding-top:24pt;line-height:1.15;text-align:left;color:#000000;font-size:36pt;font-family:"Arial";font-weight:bold;padding-bottom:6pt}.subtitle{padding-top:18pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:24pt;font-family:"Georgia";padding-bottom:4pt}li{color:#000000;font-size:11pt;font-family:"Arial"}p{color:#000000;font-size:11pt;margin:0;font-family:"Arial"}h1{padding-top:35pt;line-height:1.15;text-align:left;color:#000000;font-size:18pt;font-family:"Arial";font-weight:bold;padding-bottom:6pt}h2{padding-top:18pt;line-height:1.15;text-align:left;color:#000000;font-size:14pt;font-family:"Arial";font-weight:bold;padding-bottom:4pt}h3{padding-top:14pt;line-height:1.15;text-align:left;color:#666666;font-size:12pt;font-family:"Arial";font-weight:bold;padding-bottom:4pt}h4{padding-top:12pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:11pt;font-family:"Arial";padding-bottom:2pt}h5{padding-top:11pt;line-height:1.15;text-align:left;color:#666666;font-size:10pt;font-family:"Arial";font-weight:bold;padding-bottom:2pt}h6{padding-top:10pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:10pt;font-family:"Arial";padding-bottom:2pt}</style>
</head>
<body>
        <!--[if lt IE 7]>
        <p class=chromeframe>
          Your browser is <em>ancient!</em>
          <a href="http://browsehappy.com/">Upgrade to a different browser</a>
          or
          <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a>
          to experience this site.
        </p>
        <![endif]-->

        <div class="navbar navbar-fixed-top">
          <div class="navbar-inner">
            <div class="container">
              <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </a>
              <a class="brand" href="#">
                <span class="coolFont">Ido's Hack Space</span>
              </a>
              <div class="nav-collapse">
                <ul class="nav">
                  <li class="active">
                    <a href="http://ido-green.appspot.com/">Home</a>
                  </li>
                  <li>
                    <a href="https://github.com/greenido" target="_blank">Code</a>
                  </li>
                  <li>
                    <a href="http://greenido.wordpress.com/" target="_blank">News</a>
                  </li>

                  <ul class="nav pull-right">

                    <li class="divider-vertical"></li>
                    <li class="dropdown">
                      <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                        Other Stuff <b class="caret"></b>
                      </a>
                      <ul class="dropdown-menu">
                        <li>
                          <a href="http://about.me/greenido" target="_blank">About</a>
                        </li>
                        <li>
                          <a href="http://plus.ly/greenido" target="_blank">+greenido</a>
                        </li>
                        <li>
                          <a href="https://twitter.com/#!/greenido" target="_blank">@greenido</a>
                        </li>
                        <li class="divider"></li>
                        <li class="nav-header">Posts & Code</li>
                        <li>
                          <a href="https://github.com/greenido" target="_blank">GitHub</a>
                        </li>
                        <li>
                          <a href="http://greenido.wordpress.com/" target="_blank">My blog</a>
                        </li>
                      </ul>
                    </li>
                  </ul>

                  <li>
                    <div id="plusone">
                      <g:plusone></g:plusone>
                    </div>
                  </li>
                </ul>
              </div>
              <!--/.nav-collapse --> </div>
          </div>
        </div>

        <div class="container">

          <h1 class="c3">
            <span class="c27 c45">
              HTML5 and App Engine: The Epic Tag Team Take on Modern Web Apps at Scale
            </span>
          </h1>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              Ido and I had a great time doing this session at IO. &nbsp;The video will be posted shortly, but in the meantime, here is a little walkthrough. &nbsp;
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>Slides:</span>
            <span class="c20">
              <a class="c13" href="http://ido-green.appspot.com/">http://ido-green.appspot.com</a>
            </span>
          </p>
          <p class="c3">
            <span>Code:</span>
            <span class="c20">
              <a class="c13" href="https://github.com/greenido/backbone-bira">https://github.com/greenido/backbone-bira</a>
            </span>
            <span>&nbsp;</span>
          </p>
          <p class="c3">
            <span>Video:</span>
            <span class="c20">
              <a class="c13" href="http://www.youtube.com/watch?v=v9TG7OzsZqQ">http://www.youtube.com/watch?v=v9TG7OzsZqQ</a>
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>Pre-reqs</span>
          </p>
          <ol class="c22" start="1">
            <li class="c14 c3">
              <span class="c20">
                <a class="c13" href="https://developers.google.com/eclipse/">Google Plugin for Eclipse</a>
              </span>
            </li>
            <li class="c14 c3">
              <span class="c20">
                <a class="c13" href="http://code.google.com/p/google-api-javascript-client/">Google API JavaScript client library</a>
              </span>
              <span>&nbsp;</span>
            </li>
            <li class="c14 c3">
              <span class="c20">
                <a class="c13" href="http://endpoints-trusted-tester.appspot.com">Sign up for Cloud Endpoints</a>
              </span>
            </li>
          </ol>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              User Experiences demands are pushing modern web apps to a more distributed architecture. &nbsp;A pattern many developers have used is using a MVC framework on the client and communicate to the server with REST. &nbsp;
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              Google App Engine&rsquo;s easy to build, easy to manage environment makes it ideal for REST APIs for Web backends. &nbsp;At Google IO 2012, we made it much easier to build REST APIs on App Engine with Cloud Endpoints. &nbsp;
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c34">
            <img height="133" src="images/image13.png" width="174">
            <span>&nbsp;</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              Cloud Endpoints enables you to build REST and RPC APIs in App Engine. &nbsp;It leverages the same infrastructure &nbsp;Google uses for its own API and as such, you get strongly typed clients for Android, and IOS as well as a lightweight client for JavaScript which we will be walking through in this presentation. &nbsp;
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <img height="218" src="images/image02.png" width="421"></p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              In getting ready for IO, Ido and I thought we&rsquo;d build a modern web application using Cloud Endpoints. &nbsp;We decided on a topic that would be relevant to both App Engine and the general web developer community, something we both have some interest in and something generally useful.... a Beer rating and review web application.
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <img height="542" src="images/image00.png" width="685"></p>
          <p class="c3">
            <span>Try it out yourself at: &nbsp;</span>
            <span class="c20">
              <a class="c13" href="http://birra-io2012.appspot.com/">http://birra-io2012.appspot.com/</a>
            </span>
            <span>&nbsp;</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              The general architecture of the app is very basic. &nbsp;We are storing beer metadata in the data store, doing some application logic on the app engine app, then exposing a REST based interface to a web client. &nbsp;
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <img height="138" src="images/image17.png" width="439"></p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c44">
            <span class="c19">
              It&rsquo;s not an easy definition since web technology is running very fast. Nevertheless, we can find certain features across successful web apps:
            </span>
          </p>
          <ol class="c22" start="1">
            <li class="c30 c3">
              <span class="c19 c4">Self Contained &amp; Functional</span>
              <span class="c19">
                - They all have one specific goal and they do their best to provide the users the functionality to get to her goal. Few examples:
              </span>
            </li>
          </ol>
          <ol class="c42" start="1">
            <li class="c48 c3">
              <span class="c27 c31">
                <a class="c13" href="http://www.nytimes.com/chrome/#/Top+News">New York Times</a>
              </span>
              <span class="c19">&nbsp;&ndash; Consume news.</span>
            </li>
            <li class="c3 c48">
              <span class="c27 c31">
                <a class="c13" href="http://goo.gl/5cJwH">Hipmunk</a>
              </span>
              <span class="c19">
                &nbsp;&ndash; Find a flight that is the &lsquo;perfect&rsquo; for your needs.
              </span>
            </li>
            <li class="c48 c3">
              <span class="c27 c31">
                <a class="c13" href="http://www.gojee.com/">Gojee</a>
              </span>
              <span class="c19">
                &nbsp;&ndash; Find the recipe you would taste and say WOW after it.
              </span>
            </li>
          </ol>
          <ol class="c22" start="1">
            <li class="c3 c30">
              <span class="c19 c4">&ldquo;Offline first&rdquo;</span>
              <span class="c19">
                &nbsp;&ndash; You will want your web app to work offline. It&rsquo;s an important feature that will let your users be productive on places like: planes, subways etc&rsquo;. Another very important benefit will be the improve in performance. Since the app will work locally (first) and then sync the state/data the users will get responsiveness that are far better from an app that need to &lsquo;wait&rsquo; for network on every action that the user does.
              </span>
            </li>
          </ol>
          <ol class="c22" start="1">
            <li class="c30 c3">
              <span class="c19 c4">Client Side Architecture</span>
              <span class="c19">
                &nbsp;&ndash; Since we are moving big parts of our &lsquo;logic&rsquo; to the client we need to think about methods that will keep your code readable and maintainable. I guess this is the main reason why we see so many MVC Frameworks. The only advice we can give here is to try few of the popular ones and see how they approach the separation between the data and the UI. If you have some time go over
              </span>
              <span class="c27 c31">
                <a class="c13" href="http://codebrief.com/2012/01/the-top-10-javascript-mvc-frameworks-reviewed/">The Top 10 Javascript MVC Frameworks Reviewed</a>
              </span>
              <span class="c19">
                . Then, after you try &lsquo;some&rsquo; you will be able to pick the one that fit the bill in the best way. For the busy developer (I know&hellip; most of us don&rsquo;t have too much free time &ndash; Go and play with these three MVC:
              </span>
            </li>
          </ol>
          <ol class="c42" start="1">
            <li class="c9 c3">
              <span class="c27 c31">
                <a class="c13" href="http://emberjs.com/">Ember.js</a>
              </span>
              <span class="c19">&nbsp;&ndash; Don&rsquo;t waste time making trivial choices</span>
            </li>
            <li class="c9 c3">
              <span class="c27 c31">
                <a class="c13" href="http://angularjs.org/">Angular.js</a>
              </span>
              <span class="c19">&nbsp;-Lets you extend HTML vocabulary for your application</span>
            </li>
            <li class="c3 c9">
              <span class="c27 c31">
                <a class="c13" href="http://documentcloud.github.com/backbone/">Backbone.js</a>
              </span>
              <span class="c19">
                &nbsp;&ndash; gives structure to web applications by providing models with binding, collections and views.
              </span>
            </li>
          </ol>
          <ol class="c22" start="1">
            <li class="c30 c3">
              <span class="c19 c4">Device Aware</span>
              <span class="c19">
                &nbsp;&ndash; We all know that mobile is going &lsquo;up and right&rsquo;. So when you design your web app you should think on
              </span>
              <span class="c27 c31">
                <a class="c13" href="http://en.wikipedia.org/wiki/Progressive_enhancement">progressive enhancement</a>
              </span>
              <span class="c19">
                &nbsp;and how it will fit &nbsp;to different screen sizes. Good examples to look at are: Gmail, Google plus etc&rsquo;. If you want to go deeper on this interesting subject there is a
              </span>
              <span class="c27 c31">
                <a class="c13" href="http://www.oreillynet.com/pub/e/2295">webcast on &lsquo;mobile web apps&rsquo;</a>
              </span>
              <span class="c19">&nbsp;I did with Oreilly three weeks ago.</span>
            </li>
          </ol>
          <p class="c3 c6 c44">
            <span></span>
          </p>
          <p class="c3">
            <span>
              Let&rsquo;s take a look at what it takes to build this application.
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>I have Eclipse and the latest version of the</span>
            <span class="c20">
              <a class="c13" href="https://developers.google.com/eclipse/">Google Plugin for Eclipse</a>
            </span>
            <span>
              &nbsp;installed. &nbsp;We create a new Web Application, call it birra.
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <img height="720" src="images/image08.png" width="608"></p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              Then, if we are going to build a Beer rating app... the first thing we are going to need is... beer! &nbsp;
            </span>
          </p>
          <p class="c3">
            <span>Let&rsquo;s create a Beer class.</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              It is just a standard POJO for storing information about a beer..
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4">class</span>
            <span class="c0">&nbsp;Beer</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">private</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">Long</span>
            <span class="c0">&nbsp;id</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">private</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">String</span>
            <span class="c0">&nbsp;beerName</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">private</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">String</span>
            <span class="c0">&nbsp;kindOfBeer</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">private</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">Long</span>
            <span class="c0">&nbsp;score</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">private</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">Long</span>
            <span class="c0">&nbsp;numberOfDrinks</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">private</span>
            <span class="c0">&nbsp;Text image</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">private</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">String</span>
            <span class="c0">&nbsp;country</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">private</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">String</span>
            <span class="c0">&nbsp;description</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">private</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">Double</span>
            <span class="c0">&nbsp;latitude</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">private</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">Double</span>
            <span class="c0">&nbsp;longitude</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">Long</span>
            <span class="c0">&nbsp;getId</span>
            <span class="c0 c1">()</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">return</span>
            <span class="c0">&nbsp;id</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4 c21">void</span>
            <span class="c0">&nbsp;setId</span>
            <span class="c0 c1">(</span>
            <span class="c0 c16">Long</span>
            <span class="c0">&nbsp;id</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">this</span>
            <span class="c0">.</span>
            <span class="c0 c17">id</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;id</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">String</span>
            <span class="c0">&nbsp;getBeerName</span>
            <span class="c0 c1">()</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">return</span>
            <span class="c0">&nbsp;beerName</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4 c21">void</span>
            <span class="c0">&nbsp;setBeerName</span>
            <span class="c0 c1">(</span>
            <span class="c0 c16">String</span>
            <span class="c0">&nbsp;beerName</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">this</span>
            <span class="c0">.</span>
            <span class="c0 c17">beerName</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;beerName</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">String</span>
            <span class="c0">&nbsp;getKindOfBeer</span>
            <span class="c0 c1">()</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">return</span>
            <span class="c0">&nbsp;kindOfBeer</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4 c21">void</span>
            <span class="c0">&nbsp;setKindOfBeer</span>
            <span class="c0 c1">(</span>
            <span class="c0 c16">String</span>
            <span class="c0">&nbsp;kindOfBeer</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">this</span>
            <span class="c0">.</span>
            <span class="c0 c17">kindOfBeer</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;kindOfBeer</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">Long</span>
            <span class="c0">&nbsp;getScore</span>
            <span class="c0 c1">()</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">return</span>
            <span class="c0">&nbsp;score</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4 c21">void</span>
            <span class="c0">&nbsp;setScore</span>
            <span class="c0 c1">(</span>
            <span class="c0 c16">Long</span>
            <span class="c0">&nbsp;score</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">this</span>
            <span class="c0">.</span>
            <span class="c0 c17">score</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;score</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">Long</span>
            <span class="c0">&nbsp;getNumberOfDrinks</span>
            <span class="c0 c1">()</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">return</span>
            <span class="c0">&nbsp;numberOfDrinks</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4 c21">void</span>
            <span class="c0">&nbsp;setNumberOfDrinks</span>
            <span class="c0 c1">(</span>
            <span class="c0 c16">Long</span>
            <span class="c0">&nbsp;numberOfDrinks</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">this</span>
            <span class="c0">.</span>
            <span class="c0 c17">numberOfDrinks</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;numberOfDrinks</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;Text getImage</span>
            <span class="c0 c1">()</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">return</span>
            <span class="c0">&nbsp;image</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4 c21">void</span>
            <span class="c0">&nbsp;setImage</span>
            <span class="c0 c1">(</span>
            <span class="c0">Text image</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">this</span>
            <span class="c0">.</span>
            <span class="c0 c17">image</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;image</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">String</span>
            <span class="c0">&nbsp;getCountry</span>
            <span class="c0 c1">()</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">return</span>
            <span class="c0">&nbsp;country</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4 c21">void</span>
            <span class="c0">&nbsp;setCountry</span>
            <span class="c0 c1">(</span>
            <span class="c0 c16">String</span>
            <span class="c0">&nbsp;country</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">this</span>
            <span class="c0">.</span>
            <span class="c0 c17">country</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;country</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">String</span>
            <span class="c0">&nbsp;getDescription</span>
            <span class="c0 c1">()</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">return</span>
            <span class="c0">&nbsp;description</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4 c21">void</span>
            <span class="c0">&nbsp;setDescription</span>
            <span class="c0 c1">(</span>
            <span class="c0 c16">String</span>
            <span class="c0">&nbsp;description</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">this</span>
            <span class="c0">.</span>
            <span class="c0 c17">description</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;description</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">Double</span>
            <span class="c0">&nbsp;getLatitude</span>
            <span class="c0 c1">()</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">return</span>
            <span class="c0">&nbsp;latitude</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4 c21">void</span>
            <span class="c0">&nbsp;setLatitude</span>
            <span class="c0 c1">(</span>
            <span class="c0 c16">Double</span>
            <span class="c0">&nbsp;latitude</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">this</span>
            <span class="c0">.</span>
            <span class="c0 c17">latitude</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;latitude</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">Double</span>
            <span class="c0">&nbsp;getLongitude</span>
            <span class="c0 c1">()</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">return</span>
            <span class="c0">&nbsp;longitude</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4 c21">void</span>
            <span class="c0">&nbsp;setLongitude</span>
            <span class="c0 c1">(</span>
            <span class="c0 c16">Double</span>
            <span class="c0">&nbsp;longitude</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">this</span>
            <span class="c0">.</span>
            <span class="c0 c17">longitude</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;longitude</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3">
            <span class="c0 c1">}</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              Ok, that is a great Beer -- now we want to teach App Engine how to persist instances of this beer class in the datastore. &nbsp;To do that, we will use the classic Java JDO support. &nbsp;You can of course use any persistence layer (or roll your own) with Cloud Endpoints.
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span class="c0 c4">import</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c24">javax.jdo.annotations.IdGeneratorStrategy</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0 c4">import</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c24">javax.jdo.annotations.IdentityType</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0 c4">import</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c24">javax.jdo.annotations.PersistenceCapable</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0 c4">import</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c24">javax.jdo.annotations.Persistent</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0 c4">import</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c24">javax.jdo.annotations.PrimaryKey</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp;</span>
          </p>
          <p class="c3">
            <span class="c0">@PersistenceCapable</span>
            <span class="c0 c1">(</span>
            <span class="c0">identityType</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;IdentityType.</span>
            <span class="c0 c17">APPLICATION</span>
            <span class="c0 c1">)</span>
          </p>
          <p class="c3">
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4">class</span>
            <span class="c0">&nbsp;Beer</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; @PrimaryKey</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; @Persistent</span>
            <span class="c0 c1">(</span>
            <span class="c0">valueStrategy</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;IdGeneratorStrategy.</span>
            <span class="c0 c17">IDENTITY</span>
            <span class="c0 c1">)</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">private</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">Long</span>
            <span class="c0">&nbsp;id</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              Now we need to expose these Beers to the JavaScript client. &nbsp;To do that, we need to use the new cloud Endpoints feature. &nbsp;
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <img height="710" src="images/image01.png" width="655"></p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              That creates a template class that does the basic List, Add, Update, and Delete operations. &nbsp;The code is meant to be a starter that you can modify to add your application logic. &nbsp;
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <ol class="c32" start="1">
            <li class="c7 c3">
              <span class="c0">@Api</span>
              <span class="c0 c1">(</span>
              <span class="c0">name</span>
              <span class="c0 c2">=</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c10">&quot;birra&quot;</span>
              <span class="c0 c1">
                )
                <br>
                <br></span>
              <span>
                In line 1 above we use the @Api attribute. &nbsp;This attribute tells App Engine to expose this class as a REST\RPC endpoints. &nbsp; Be aware that all the public methods on this class will be accessible via REST endpoint.
                <br>
                <br>
                I have also changed the name to birra to match with the rest of the application. &nbsp;We will later see this name show up the REST URL. &nbsp;
                <br></span>
            </li>
            <li class="c7 c3">
              <span class="c0 c4">public</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c4">class</span>
              <span class="c0">&nbsp;BeerEndpoint</span>
              <span class="c0 c1">{</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp;</span>
              <span class="c0 c26 c4">/**</span>
            </li>
            <li class="c7 c3">
              <span class="c0 c26 c4">
                &nbsp; &nbsp;* This method lists all the entities inserted in datastore.
              </span>
            </li>
            <li class="c7 c3">
              <span class="c0 c26 c4">&nbsp; &nbsp;* It uses HTTP GET method.</span>
            </li>
            <li class="c7 c3">
              <span class="c0 c26 c4">&nbsp; &nbsp;*</span>
            </li>
            <li class="c7 c3">
              <span class="c0 c26 c4">&nbsp; &nbsp;* @return List of all entities persisted.</span>
            </li>
            <li class="c7 c3">
              <span class="c0 c26 c4">&nbsp; &nbsp;*/</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; @SuppressWarnings</span>
              <span class="c0 c1">({</span>
              <span class="c0 c10">&quot;cast&quot;</span>
              <span class="c0">,</span>
              <span class="c0 c10">&quot;unchecked&quot;</span>
              <span class="c0 c1">})</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp;</span>
              <span class="c0 c4">public</span>
              <span class="c0">&nbsp;List</span>
              <span class="c0 c2">&lt;</span>
              <span class="c0">Beer</span>
              <span class="c0 c2">&gt;</span>
              <span class="c0">&nbsp;listBeer</span>
              <span class="c0 c1">()</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c1">{</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; PersistenceManager mgr</span>
              <span class="c0 c2">=</span>
              <span class="c0">&nbsp;getPersistenceManager</span>
              <span class="c0 c1">()</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; List</span>
              <span class="c0 c2">&lt;</span>
              <span class="c0">Beer</span>
              <span class="c0 c2">&gt;</span>
              <span class="c0">&nbsp;result</span>
              <span class="c0 c2">=</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c4 c21">null</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp;</span>
              <span class="c0 c4">try</span>
              <span class="c0 c1">{</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; Query query</span>
              <span class="c0 c2">=</span>
              <span class="c0">&nbsp;mgr.</span>
              <span class="c0 c17">newQuery</span>
              <span class="c0 c1">(</span>
              <span class="c0">Beer.</span>
              <span class="c0 c4">class</span>
              <span class="c0 c1">)</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; result</span>
              <span class="c0 c2">=</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c1">(</span>
              <span class="c0">List</span>
              <span class="c0 c2">&lt;</span>
              <span class="c0">Beer</span>
              <span class="c0 c2">&gt;</span>
              <span class="c0 c1">)</span>
              <span class="c0">&nbsp;query.</span>
              <span class="c0 c17">execute</span>
              <span class="c0 c1">()</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp;</span>
              <span class="c0 c28 c39">
                // Tight loop for fetching all entities from datastore and accommodate
              </span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp;</span>
              <span class="c0 c28 c39">// for lazy fetch.</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp;</span>
              <span class="c0 c4">for</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c1">(</span>
              <span class="c0">Beer beer</span>
              <span class="c0 c2">:</span>
              <span class="c0">result</span>
              <span class="c0 c1">)</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp;</span>
              <span class="c0 c1">}</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c4">finally</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c1">{</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; mgr.</span>
              <span class="c0 c17">close</span>
              <span class="c0 c1">()</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp;</span>
              <span class="c0 c1">}</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp;</span>
              <span class="c0 c4">return</span>
              <span class="c0">&nbsp;result</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp;</span>
              <span class="c0 c1">
                }
                <br>
                <br></span>
              <span>
                In 2-24, GPE has defined a basic list function. &nbsp; It simply returns all the Beers in the datastore. &nbsp; This method will be exposed as a http GET on method
                <br>
                <br></span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp;</span>
              <span class="c0 c26 c4">/**</span>
            </li>
            <li class="c7 c3">
              <span class="c0 c26 c4">
                &nbsp; &nbsp;* This method gets the entity having primary key id. It uses HTTP GET method.
              </span>
            </li>
            <li class="c7 c3">
              <span class="c0 c26 c4">&nbsp; &nbsp;*</span>
            </li>
            <li class="c7 c3">
              <span class="c0 c26 c4">&nbsp; &nbsp;* @param id the primary key of the java bean.</span>
            </li>
            <li class="c7 c3">
              <span class="c0 c26 c4">&nbsp; &nbsp;* @return The entity with primary key id.</span>
            </li>
            <li class="c7 c3">
              <span class="c0 c26 c4">&nbsp; &nbsp;*/</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp;</span>
              <span class="c0 c4">public</span>
              <span class="c0">&nbsp;Beer getBeer</span>
              <span class="c0 c1">(</span>
              <span class="c0">@Named</span>
              <span class="c0 c1">(</span>
              <span class="c0 c10">&quot;id&quot;</span>
              <span class="c0 c1">)</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c16">Long</span>
              <span class="c0">&nbsp;id</span>
              <span class="c0 c1">)</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c1">{</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; PersistenceManager mgr</span>
              <span class="c0 c2">=</span>
              <span class="c0">&nbsp;getPersistenceManager</span>
              <span class="c0 c1">()</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; Beer beer &nbsp;</span>
              <span class="c0 c2">=</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c4 c21">null</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp;</span>
              <span class="c0 c4">try</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c1">{</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; beer</span>
              <span class="c0 c2">=</span>
              <span class="c0">&nbsp;mgr.</span>
              <span class="c0 c17">getObjectById</span>
              <span class="c0 c1">(</span>
              <span class="c0">Beer.</span>
              <span class="c0 c4">class</span>
              <span class="c0">, id</span>
              <span class="c0 c1">)</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp;</span>
              <span class="c0 c1">}</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c4">finally</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c1">{</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; mgr.</span>
              <span class="c0 c17">close</span>
              <span class="c0 c1">()</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp;</span>
              <span class="c0 c1">}</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp;</span>
              <span class="c0 c4">return</span>
              <span class="c0">&nbsp;beer</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp;</span>
              <span class="c0 c1">}</span>
            </li>
            <li class="c7 c3">
              <span class="c0">
                &nbsp;
                <br>
                <br></span>
              <span>
                In the above section, GPE has given us a basic get method. &nbsp;Given an ID for a beer, it will return the full beer instance. &nbsp;It is exposed as an HTTP GET.. for example beer/42
              </span>
              <span class="c0">
                <br></span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp;</span>
              <span class="c0 c26 c4">/**</span>
            </li>
            <li class="c7 c3">
              <span class="c0 c26 c4">
                &nbsp; &nbsp;* This inserts the entity into App Engine datastore.
              </span>
            </li>
            <li class="c7 c3">
              <span class="c0 c26 c4">&nbsp; &nbsp;* It uses HTTP POST method.</span>
            </li>
            <li class="c7 c3">
              <span class="c0 c26 c4">&nbsp; &nbsp;*</span>
            </li>
            <li class="c7 c3">
              <span class="c0 c26 c4">&nbsp; &nbsp;* @param beer the entity to be inserted.</span>
            </li>
            <li class="c7 c3">
              <span class="c0 c26 c4">&nbsp; &nbsp;* @return The inserted entity.</span>
            </li>
            <li class="c7 c3">
              <span class="c0 c26 c4">&nbsp; &nbsp;*/</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp;</span>
              <span class="c0 c4">public</span>
              <span class="c0">&nbsp;Beer insertBeer</span>
              <span class="c0 c1">(</span>
              <span class="c0">Beer beer</span>
              <span class="c0 c1">)</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c1">{</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; PersistenceManager mgr</span>
              <span class="c0 c2">=</span>
              <span class="c0">&nbsp;getPersistenceManager</span>
              <span class="c0 c1">()</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp;</span>
              <span class="c0 c4">try</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c1">{</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; mgr.</span>
              <span class="c0 c17">makePersistent</span>
              <span class="c0 c1">(</span>
              <span class="c0">beer</span>
              <span class="c0 c1">)</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp;</span>
              <span class="c0 c1">}</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c4">finally</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c1">{</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; mgr.</span>
              <span class="c0 c17">close</span>
              <span class="c0 c1">()</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp;</span>
              <span class="c0 c1">}</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp;</span>
              <span class="c0 c4">return</span>
              <span class="c0">&nbsp;beer</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp;</span>
              <span class="c0 c1">}</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp;</span>
            </li>
          </ol>
          <p class="c3 c6">
            <span class="c0"></span>
          </p>
          <p class="c3">
            <span>
              In the above section, GPE has given us a basic insert method. &nbsp;It takes the Beer and stores it in the datastore, which gives it &nbsp;an ID, then we return it back to the client. &nbsp; It is exposed as an HTTP POST.
            </span>
          </p>
          <p class="c3 c6">
            <span class="c0"></span>
          </p>
          <p class="c3 c6">
            <span class="c0"></span>
          </p>
          <ol class="c32" start="60">
            <li class="c7 c3">
              <span class="c0">&nbsp;</span>
              <span class="c0 c26 c4">/**</span>
            </li>
            <li class="c3 c7">
              <span class="c0 c4 c26">&nbsp; &nbsp;* This method is used for updating a entity.</span>
            </li>
            <li class="c7 c3">
              <span class="c0 c26 c4">&nbsp; &nbsp;* It uses HTTP PUT method.</span>
            </li>
            <li class="c7 c3">
              <span class="c0 c26 c4">&nbsp; &nbsp;*</span>
            </li>
            <li class="c7 c3">
              <span class="c0 c26 c4">&nbsp; &nbsp;* @param beer the entity to be updated.</span>
            </li>
            <li class="c7 c3">
              <span class="c0 c26 c4">&nbsp; &nbsp;* @return The updated entity.</span>
            </li>
            <li class="c7 c3">
              <span class="c0 c26 c4">&nbsp; &nbsp;*/</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp;</span>
              <span class="c0 c4">public</span>
              <span class="c0">&nbsp;Beer updateBeer</span>
              <span class="c0 c1">(</span>
              <span class="c0">Beer beer</span>
              <span class="c0 c1">)</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c1">{</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; PersistenceManager mgr</span>
              <span class="c0 c2">=</span>
              <span class="c0">&nbsp;getPersistenceManager</span>
              <span class="c0 c1">()</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp;</span>
              <span class="c0 c4">try</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c1">{</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; mgr.</span>
              <span class="c0 c17">makePersistent</span>
              <span class="c0 c1">(</span>
              <span class="c0">beer</span>
              <span class="c0 c1">)</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp;</span>
              <span class="c0 c1">}</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c4">finally</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c1">{</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; mgr.</span>
              <span class="c0 c17">close</span>
              <span class="c0 c1">()</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp;</span>
              <span class="c0 c1">}</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp;</span>
              <span class="c0 c4">return</span>
              <span class="c0">&nbsp;beer</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp;</span>
              <span class="c0 c1">}</span>
            </li>
            <li class="c7 c3">
              <span class="c0">
                &nbsp;
                <br>
                <br></span>
              <span>
                In the above section, GPE has given us a basic update method. &nbsp;It takes the Beer updates it in the database. &nbsp; It is exposed as an HTTP PUT.
              </span>
              <span class="c0">
                <br></span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp;</span>
              <span class="c0 c26 c4">/**</span>
            </li>
            <li class="c7 c3">
              <span class="c0 c26 c4">
                &nbsp; &nbsp;* This method removes the entity with primary key id.
              </span>
            </li>
            <li class="c7 c3">
              <span class="c0 c26 c4">&nbsp; &nbsp;* It uses HTTP DELETE method.</span>
            </li>
            <li class="c7 c3">
              <span class="c0 c26 c4">&nbsp; &nbsp;*</span>
            </li>
            <li class="c7 c3">
              <span class="c0 c26 c4">
                &nbsp; &nbsp;* @param id the primary key of the entity to be deleted.
              </span>
            </li>
            <li class="c7 c3">
              <span class="c0 c26 c4">&nbsp; &nbsp;* @return The deleted entity.</span>
            </li>
            <li class="c7 c3">
              <span class="c0 c26 c4">&nbsp; &nbsp;*/</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp;</span>
              <span class="c0 c4">public</span>
              <span class="c0">&nbsp;Beer removeBeer</span>
              <span class="c0 c1">(</span>
              <span class="c0">@Named</span>
              <span class="c0 c1">(</span>
              <span class="c0 c10">&quot;id&quot;</span>
              <span class="c0 c1">)</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c16">Long</span>
              <span class="c0">&nbsp;id</span>
              <span class="c0 c1">)</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c1">{</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; PersistenceManager mgr</span>
              <span class="c0 c2">=</span>
              <span class="c0">&nbsp;getPersistenceManager</span>
              <span class="c0 c1">()</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp;Beer beer &nbsp;</span>
              <span class="c0 c2">=</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c4 c21">null</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp;</span>
              <span class="c0 c4">try</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c1">{</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; beer</span>
              <span class="c0 c2">=</span>
              <span class="c0">&nbsp;mgr.</span>
              <span class="c0 c17">getObjectById</span>
              <span class="c0 c1">(</span>
              <span class="c0">Beer.</span>
              <span class="c0 c4">class</span>
              <span class="c0">, id</span>
              <span class="c0 c1">)</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; mgr.</span>
              <span class="c0 c17">deletePersistent</span>
              <span class="c0 c1">(</span>
              <span class="c0">beer</span>
              <span class="c0 c1">)</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp;</span>
              <span class="c0 c1">}</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c4">finally</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c1">{</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; mgr.</span>
              <span class="c0 c17">close</span>
              <span class="c0 c1">()</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp;</span>
              <span class="c0 c1">}</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp;</span>
              <span class="c0 c4">return</span>
              <span class="c0">&nbsp;beer</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp;</span>
              <span class="c0 c1">}</span>
            </li>
            <li class="c7 c3">
              <span class="c0">
                &nbsp;
                <br></span>
              <span>
                In the above section, GPE has given us a basic delete method. &nbsp;It takes an ID of a beer and removes it from database. &nbsp; It is exposed as an HTTP DELETE.
              </span>
              <span class="c0">
                <br></span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp;</span>
              <span class="c0 c4">private</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c4">static</span>
              <span class="c0">&nbsp;PersistenceManager getPersistenceManager</span>
              <span class="c0 c1">()</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c1">{</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp;</span>
              <span class="c0 c4">return</span>
              <span class="c0">&nbsp;PMF.</span>
              <span class="c0 c17">get</span>
              <span class="c0 c1">()</span>
              <span class="c0">.</span>
              <span class="c0 c17">getPersistenceManager</span>
              <span class="c0 c1">()</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp;</span>
              <span class="c0 c1">}</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp;</span>
            </li>
            <li class="c7 c3">
              <span class="c0 c1">}</span>
            </li>
          </ol>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              Let&rsquo;s test this locally with curl to ensure it is working well before we start to build out a our web client. &nbsp; First we start the local development time server by hitting debug. &nbsp;
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <img height="177" src="images/image05.png" width="256"></p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              Now we see our local development time server up and running. &nbsp;From there we also get hint as to the right URL to use for curl.
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <img height="142" src="images/image03.png" width="621"></p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span class="c4 c8">% curl http://localhost:8888/_ah/api/birra/v1/beer</span>
          </p>
          <p class="c3">
            <span class="c4 c8">{</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;items&quot; : [ ]</span>
          </p>
          <p class="c3">
            <span class="c4 c8">}</span>
          </p>
          <p class="c3 c6">
            <span class="c4 c8"></span>
          </p>
          <p class="c3">
            <span>
              Above you can see we are hitting our local development time server. &nbsp;Then we use the _ah namespace which is the standard app engine reserved namespace... this ensures there are not conflicts with any web pages in your app. &nbsp;The we use the /api/birra path. &nbsp;&ldquo;birra&rdquo; comes from the @Api() attribute at the top of the BeerEndpoints.java file. &nbsp;Then we access the beer endpoint. This comes from the name of the type the List method returns. &nbsp;
            </span>
          </p>
          <p class="c3">
            <span>
              The results is an empty list encoded as JSON. &nbsp; &nbsp;Let&rsquo;s look at how we add an item.
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span class="c4 c8">
              % curl &nbsp;-H &#39;Content-Type: appilcation/json&#39; -d &#39;{&quot;beerName&quot;: &quot;bud&quot;}&#39; http://localhost:8888/_ah/api/birra/v1/beer
            </span>
          </p>
          <p class="c3">
            <span class="c4 c8">{</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;id&quot; : 1,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;beerName&quot; : &quot;bud&quot;,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;kindOfBeer&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;score&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;numberOfDrinks&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;image&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;country&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;description&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;latitude&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;longitude&quot; : null</span>
          </p>
          <p class="c3">
            <span class="c4 c8">}</span>
          </p>
          <p class="c3 c6">
            <span class="c8"></span>
          </p>
          <p class="c3">
            <span>
              Above you can see we are doing an HTTP POST passing a json encoded blob where we set the beerName to bud. &nbsp; The results is a JSON blob of the beer after it has been added to the datastore. &nbsp;Notice it has an ID set which we can use to query for it later. &nbsp;
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span class="c4 c8">% &nbsp;curl http://localhost:8888/_ah/api/birra/v1/beer/1</span>
          </p>
          <p class="c3">
            <span class="c4 c8">{</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;id&quot; : 1,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;beerName&quot; : &quot;bud&quot;,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;kindOfBeer&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;score&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;numberOfDrinks&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;image&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;country&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;description&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;latitude&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;longitude&quot; : null</span>
          </p>
          <p class="c3">
            <span class="c4 c8">}</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              The above code calls the getBeer method passing beerId of 1 and this returns a JSON blob of the beer. &nbsp;
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>As we will see later, we can use the</span>
            <span class="c20">
              <a class="c13" href="http://code.google.com/p/google-api-javascript-client/">Google API JavaScript client library</a>
            </span>
            <span>
              &nbsp;to access our methods. &nbsp;To control what they look like in the JavaScript code, we can use the @Api attribute in the
            </span>
            <span class="c8">com.google.api.server.spi.config.ApiMethod</span>
            <span>
              &nbsp;package. &nbsp; &nbsp;We will look a fair bit at the customization options this attribute gives us later in the post. &nbsp;
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp;@ApiMethod</span>
            <span class="c1 c23">(</span>
            <span class="c0">name</span>
            <span class="c23 c2">=</span>
            <span class="c23 c10">&quot;beers.delete&quot;</span>
            <span class="c23 c1">)</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp;</span>
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;Beer removeBeer</span>
            <span class="c0 c1">(</span>
            <span class="c0">@Named</span>
            <span class="c0 c1">(</span>
            <span class="c0 c10">&quot;id&quot;</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">Long</span>
            <span class="c0">&nbsp;id</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              That is great that we can do this level of testing on the client, but let&rsquo;s take a look at a version of this I deployed earlier. &nbsp;You can get a list of all the APIs on your app engine app by hitting:
            </span>
          </p>
          <p class="c3">
            <span class="c8">https://&lt;appid&gt;.appspot.com/_ah/api/discovery/v1/apis</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <img height="432" src="images/image19.png" width="557"></p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              Above you can see that discovery is tell us we have two APIs. The top one is the discovery API itself and the bottom one is the birra API we just created. &nbsp; &nbsp;Clicking on the
            </span>
            <span class="c28">discoveryRestUrl</span>
            <span>
              &nbsp;link we see the discovery doc for our API. &nbsp;This is the exact same discovery doc format we use for most Google APIs and as such works with our Google Client Libraries.
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <img height="733" src="images/image09.png" width="452"></p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span class="c4 c8"></span>
          </p>
          <p class="c3 c6">
            <span class="c4 c8"></span>
          </p>
          <p class="c3">
            <span>In addition, we can use the</span>
            <span class="c20">
              <a class="c13" href="https://code.google.com/apis/explorer/">Google API Explorer</a>
            </span>
            <span>
              &nbsp;with our custom API. &nbsp;It is very easy to get to by using the explorer shortcut. &nbsp;http://&lt;appid&gt;.appspot.com/_ah/api/explorer
            </span>
          </p>
          <p class="c3 c6">
            <span class="c4 c8"></span>
          </p>
          <p class="c3">
            <img height="385" src="images/image16.png" width="535"></p>
          <p class="c3">
            <span>
              Above we see &nbsp;a list of all the methods we defined in our API. &nbsp;Clicking on any of them allows me to interact with that method live.
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <img height="729" src="images/image06.png" width="618"></p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              Notice that we see the exact http request and the response. &nbsp;This is a very nice way to debug the API independently from the client. &nbsp;It also gives you all the insight into request and response formats to help you build out great clients. &nbsp;
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              Now, let&rsquo;s take a look at using this API from JavaScript.. &nbsp;
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <h2 class="c3">
            <a name="h.af046njyqbjj"></a>
            <span>Client side code to get a list of beers</span>
          </h2>
          <p class="c3">
            <span>
              As we all know, in software development it&rsquo;s good to take small steps. So first thing we will try to do is to run a simple ajax request.
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span class="c23 c35">
              var apiUrl = &quot;https://birra-io2012.appspot.com/_ah/api/birra/v1/beer&quot;;
              <br>
              $.ajax({
              <br>
              &nbsp;url: apiUrl,
              <br>
              &nbsp;dataType: &#39;json&#39;,
              <br>
              &nbsp;contentType: &#39;application/json&#39;,
              <br>
              &nbsp;type: &quot;GET&quot;,
              <br>
              &nbsp;success: function(data) {
              <br>
              &nbsp; &nbsp;showList(data);
              <br>
              &nbsp;},
              <br>
              &nbsp;error: function(xhr, ajaxOptions, thrownError) {
              <br>
              &nbsp; &nbsp;console.error(&quot;Beer list error: &quot; + xhr.status);
              <br>
              &nbsp;} &nbsp;
              <br>});</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>You can try this generic test page</span>
            <span>from</span>
            <span>:</span>
            <span class="c20">
              <a class="c13" href="https://github.com/greenido/backbone-bira/blob/master/test-page/index_ini_1.html">
                https://github.com/greenido/backbone-bira/blob/master/test-page/index_ini_1.html
              </a>
            </span>
          </p>
          <p class="c3">
            <span>or test it live:</span>
          </p>
          <p class="c3">
            <span class="c40">
              <a class="c13" href="http://birra-io2012.appspot.com/test/">http://birra-io2012.appspot.com/test</a>
            </span>
            <span>/</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              After we were successful in getting the list of beers with plain vanilla JavaScript, it&rsquo;s time to use google api JavaScript library. Why? Well, you are getting some powerful features like:
            </span>
          </p>
          <ol class="c22" start="1">
            <li class="c12 c3">
              <span class="c27 c33">
                <a class="c13" href="http://code.google.com/p/google-api-javascript-client/wiki/RpcBatch">RPC Batch</a>
              </span>
            </li>
            <li class="c12 c3">
              <span class="c27 c33">
                <a class="c13" href="http://code.google.com/p/google-api-javascript-client/wiki/CORS">CORS</a>
              </span>
            </li>
            <li class="c12 c3">
              <span class="c27 c33">
                <a class="c13" href="http://code.google.com/p/google-api-javascript-client/wiki/Authentication">Authentication</a>
              </span>
              <span class="c27 c50">&nbsp;out of the box</span>
            </li>
            <li class="c12 c3">
              <span class="c27">Version control</span>
            </li>
            <li class="c12 c3">
              <span class="c27">Super Simple to use.</span>
            </li>
            <li class="c12 c3">
              <span class="c27">Generic</span>
            </li>
          </ol>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>The call to get the JS library:</span>
          </p>
          <p class="c3">
            <span class="c23 c35">
              &lt;script src=&quot;https://apis.google.com/js/client.js?onload=loadGapi&quot;&gt;
              <br>
              &nbsp; &nbsp;{ &quot;client&quot;: {},
              <br>
              &nbsp; &nbsp; &nbsp;&quot;googleapis.config&quot;: {
              <br>
              &nbsp; &nbsp; &nbsp; &nbsp;root: &quot;https://birra-io2012.appspot.com/_ah/api&quot;
              <br>
              &nbsp; &nbsp; &nbsp;}
              <br>
              &nbsp; &nbsp;}
              <br>
              &lt;/script&gt;
              <br></span>
          </p>
          <p class="c3">
            <span>
              The callback that will be called after Google API JS library was loaded. In our case, we wish to set the API key and load our amazing beer service: &lsquo;birra&rsquo;.
            </span>
            <span class="c23 c35">
              <br>
              function loadGapi() {
              <br>
              &nbsp;// Set the API key
              <br>
              &nbsp;gapi.client.setApiKey(&#39;AIzaSyD_mrsCOGa_cip-_O9YzmruYQ831uQcqPE&#39;);
              <br>
              &nbsp;// Set: name of service, version and callback function
              <br>
              &nbsp;gapi.client.load(&#39;birra&#39;, &#39;v1&#39;, getBeers);
              <br>
              }
              <br></span>
          </p>
          <p class="c3">
            <span class="c35">
              The callback function that will be called after our Birra service was loaded. In this case we fetch a list of beers (top 20 beers) and show them to the user.
            </span>
            <span class="c23 c35">
              <br>
              function getBeers() {
              <br>
              &nbsp; var req = gapi.client.birra.listBeer();
              <br>
              &nbsp; req.execute(function(data) {
              <br>
              &nbsp; &nbsp;showList(data);
              <br>
              &nbsp;});
              <br>}</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              Here are some of the basic Adding, Editing and Removing operations:
            </span>
          </p>
          <p class="c3">
            <span>&lt;&lt;GI TODO &gt;&gt;</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              Let&rsquo;s take a look at adding Comment support to this application. &nbsp;I may want to allow people to leave comments on the beers. &nbsp;To do that, let&rsquo;s add a new Comment class and enable it for persistence into the datastore. &nbsp;
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span class="c0">@PersistenceCapable</span>
            <span class="c0 c1">(</span>
            <span class="c0">identityType</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;IdentityType.</span>
            <span class="c0 c17">APPLICATION</span>
            <span class="c0 c1">)</span>
          </p>
          <p class="c3">
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4">class</span>
            <span class="c0">&nbsp;Comment</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; @PrimaryKey</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; @Persistent</span>
            <span class="c0 c1">(</span>
            <span class="c0">valueStrategy</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;IdGeneratorStrategy.</span>
            <span class="c0 c17">IDENTITY</span>
            <span class="c0 c1">)</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">private</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">Long</span>
            <span class="c0">&nbsp;commentId</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">private</span>
            <span class="c0">&nbsp;User user</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">private</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">String</span>
            <span class="c0">&nbsp;date</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">private</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">Long</span>
            <span class="c0">&nbsp;beerId</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">private</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">String</span>
            <span class="c0">&nbsp;comment</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3 c6">
            <span class="c0 c2"></span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">Long</span>
            <span class="c0">&nbsp;getCommentId</span>
            <span class="c0 c1">()</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">return</span>
            <span class="c0">&nbsp;commentId</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4 c21">void</span>
            <span class="c0">&nbsp;setCommentId</span>
            <span class="c0 c1">(</span>
            <span class="c0 c16">Long</span>
            <span class="c0">&nbsp;commentId</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">this</span>
            <span class="c0">.</span>
            <span class="c0 c17">commentId</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;commentId</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;User getUser</span>
            <span class="c0 c1">()</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">return</span>
            <span class="c0">&nbsp;user</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4 c21">void</span>
            <span class="c0">&nbsp;setUser</span>
            <span class="c0 c1">(</span>
            <span class="c0">User user</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">this</span>
            <span class="c0">.</span>
            <span class="c0 c17">user</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;user</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">String</span>
            <span class="c0">&nbsp;getDate</span>
            <span class="c0 c1">()</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">return</span>
            <span class="c0">&nbsp;date</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4 c21">void</span>
            <span class="c0">&nbsp;setDate</span>
            <span class="c0 c1">(</span>
            <span class="c0 c16">String</span>
            <span class="c0">&nbsp;date</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">this</span>
            <span class="c0">.</span>
            <span class="c0 c17">date</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;date</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">Long</span>
            <span class="c0">&nbsp;getBeerId</span>
            <span class="c0 c1">()</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">return</span>
            <span class="c0">&nbsp;beerId</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4 c21">void</span>
            <span class="c0">&nbsp;setBeerId</span>
            <span class="c0 c1">(</span>
            <span class="c0 c16">Long</span>
            <span class="c0">&nbsp;beerId</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">this</span>
            <span class="c0">.</span>
            <span class="c0 c17">beerId</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;beerId</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">String</span>
            <span class="c0">&nbsp;getComment</span>
            <span class="c0 c1">()</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">return</span>
            <span class="c0">&nbsp;comment</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4 c21">void</span>
            <span class="c0">&nbsp;setComment</span>
            <span class="c0 c1">(</span>
            <span class="c0 c16">String</span>
            <span class="c0">&nbsp;comment</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">this</span>
            <span class="c0">.</span>
            <span class="c0 c17">comment</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;comment</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3">
            <span class="c0 c1">}</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span class="c0 c1"></span>
          </p>
          <p class="c3">
            <span>
              Now, we need to expose Comment as part of our Birra REST API. &nbsp; &nbsp;We use the Google-&gt;Generate Cloud Endpoint class option in eclipse. &nbsp;
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              We change the name to be birra to have it be part of the same API. &nbsp;
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span class="c0">@Api</span>
            <span class="c0 c1">(</span>
            <span class="c0">name</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c10">&quot;birra&quot;</span>
            <span class="c0 c1">)</span>
          </p>
          <p class="c3">
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4">class</span>
            <span class="c0">&nbsp;CommentEndpoint</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              Then for listComment() method, notice it is returning all the comments, but that is unlikely to be what we want on the client. &nbsp;We likely want to return just the comments on a giving Beer. &nbsp;To do that, we need to pass a BeerId in. &nbsp;
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              Notice we customize the path to make it very intuitive to use as a REST interface. We also customize query for comments, to only get those with a particular beer ID
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; @ApiMethod</span>
            <span class="c0 c1">(</span>
            <span class="c0">name</span>
            <span class="c0 c2">=</span>
            <span class="c0 c10">&quot;beers.comments.list&quot;</span>
            <span class="c0">,</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;path</span>
            <span class="c0 c2">=</span>
            <span class="c0 c10">&quot;beers/{beerId}/comments&quot;</span>
            <span class="c0 c1">)</span>
          </p>
          <p class="c3">
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;List</span>
            <span class="c0 c2">&lt;</span>
            <span class="c0">Comment</span>
            <span class="c0 c2">&gt;</span>
            <span class="c0">&nbsp;listComment</span>
            <span class="c0 c1">(</span>
            <span class="c0">@Named</span>
            <span class="c0 c1">(</span>
            <span class="c0 c10">&quot;beerId&quot;</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">Long</span>
            <span class="c0">&nbsp;beerId</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; PersistenceManager mgr</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;getPersistenceManager</span>
            <span class="c0 c1">()</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; List</span>
            <span class="c0 c2">&lt;</span>
            <span class="c0">Comment</span>
            <span class="c0 c2">&gt;</span>
            <span class="c0">&nbsp;result</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4 c21">null</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp;</span>
            <span class="c0 c4">try</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; Query query</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;mgr.</span>
            <span class="c0 c17">newQuery</span>
            <span class="c0 c1">(</span>
            <span class="c0">Comment.</span>
            <span class="c0 c4">class</span>
            <span class="c0">,</span>
            <span class="c0 c10">&quot;beerId == &quot;</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">+</span>
            <span class="c0">&nbsp;beerId</span>
            <span class="c0 c1">)</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; result</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">(</span>
            <span class="c0">List</span>
            <span class="c0 c2">&lt;</span>
            <span class="c0">Comment</span>
            <span class="c0 c2">&gt;</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;query.</span>
            <span class="c0 c17">execute</span>
            <span class="c0 c1">()</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>We use the same sort of syntax all the methods on comment...</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span class="c0">@ApiMethod</span>
            <span class="c0 c1">(</span>
            <span class="c0">name</span>
            <span class="c0 c2">=</span>
            <span class="c0 c10">&quot;beers.comments.get&quot;</span>
            <span class="c0">,</span>
          </p>
          <p class="c3">
            <span class="c0">
              &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;path
            </span>
            <span class="c0 c2">=</span>
            <span class="c0 c10">&quot;beers/{beerId}/comments/{id}&quot;</span>
            <span class="c0 c1">)</span>
          </p>
          <p class="c3">
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;Comment getComment</span>
            <span class="c0 c1">(</span>
            <span class="c0">@Named</span>
            <span class="c0 c1">(</span>
            <span class="c0 c10">&quot;beerId&quot;</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">Long</span>
            <span class="c0">&nbsp;beerId, @Named</span>
            <span class="c0 c1">(</span>
            <span class="c0 c10">&quot;id&quot;</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">Long</span>
            <span class="c0">&nbsp;id</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp;</span>
          </p>
          <p class="c3">
            <span class="c0">@ApiMethod</span>
            <span class="c0 c1">(</span>
            <span class="c0">name</span>
            <span class="c0 c2">=</span>
            <span class="c0 c10">&quot;beers.comments.insert&quot;</span>
            <span class="c0">,</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;path</span>
            <span class="c0 c2">=</span>
            <span class="c0 c10">&quot;beers/{beerId}/comments&quot;</span>
            <span class="c0 c1">)</span>
          </p>
          <p class="c3">
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;Comment insertComment</span>
            <span class="c0 c1">(</span>
            <span class="c0">@Named</span>
            <span class="c0 c1">(</span>
            <span class="c0 c10">&quot;beerId&quot;</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">Long</span>
            <span class="c0">&nbsp;beerId, Comment comment</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; comment.</span>
            <span class="c0 c17">setBeerId</span>
            <span class="c0 c1">(</span>
            <span class="c0">beerId</span>
            <span class="c0 c1">)</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              Now, let&rsquo;s take a look at the curl syntax for calling this method.
            </span>
          </p>
          <p class="c3">
            <span>
              Here we do a HTTP GET for all the comments on Beer with the ID 1.
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span class="c4 c8">
              % curl http://localhost:8888/_ah/api/birra/v1/beers/1/comments
            </span>
          </p>
          <p class="c3">
            <span class="c4 c8">{</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;items&quot; : [ ]</span>
          </p>
          <p class="c3">
            <span class="c4 c8">}</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>There are none there, so let&rsquo;s add one. &nbsp;</span>
          </p>
          <p class="c3">
            <span class="c4 c8">
              % curl &nbsp; -H &#39;Content-Type: appilcation/json&#39; &nbsp;-d &#39;{&quot;comment&quot;: &quot;nice head&quot;}&#39; &nbsp;http://localhost:8888/_ah/api/birra/v1/beers/1/comments
            </span>
          </p>
          <p class="c3">
            <span class="c4 c8">{</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;commentId&quot; : 2,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;user&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;date&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;beerId&quot; : 1,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;comment&quot; : &quot;nice head&quot;</span>
          </p>
          <p class="c3">
            <span class="c4 c8">}%</span>
          </p>
          <p class="c3 c6">
            <span class="c4 c8"></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <h2 class="c3">
            <a name="h.jazh49ghaogt"></a>
            <span>Adding / Getting Comments from the client</span>
          </h2>
          <p class="c3">
            <span>
              This is the function that we will call when we wish to add a new comment to a specific beer.
            </span>
          </p>
          <p class="c3">
            <span>
              Please note to the feature object that contain all our information for a new comment.
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span class="c5">$(&quot;#saveCommentsBeer&quot;).click(function() {</span>
          </p>
          <p class="c3">
            <span class="c5">&nbsp; &nbsp; var features = {};</span>
          </p>
          <p class="c3 c6">
            <span class="c5"></span>
          </p>
          <p class="c3">
            <span class="c5">&nbsp; &nbsp; var tmpDate = new Date();</span>
          </p>
          <p class="c3">
            <span class="c5">
              &nbsp; &nbsp; tmpDate = tmpDate.format(&quot;mmm d yyyy h:MTT&quot;);
            </span>
          </p>
          <p class="c3 c6">
            <span class="c5"></span>
          </p>
          <p class="c3">
            <span class="c5">
              &nbsp; &nbsp; // We wish to know when the user add a specific comment.
            </span>
          </p>
          <p class="c3">
            <span class="c5">&nbsp; &nbsp; features[&#39;date&#39;] = tmpDate;</span>
          </p>
          <p class="c3">
            <span class="c5">
              &nbsp; &nbsp; // Here is the comment. In a real world - we wish to validate its
            </span>
          </p>
          <p class="c3">
            <span class="c5">
              &nbsp; &nbsp; // content and make sure it&rsquo;s clean (e.g. just text and nothing else).
            </span>
          </p>
          <p class="c3">
            <span class="c5">
              &nbsp; &nbsp; features[&#39;comment&#39;] &nbsp;= $(&quot;#beerComment&quot;).val();
            </span>
          </p>
          <p class="c3">
            <span class="c5">
              &nbsp; &nbsp; // Some more &lsquo;meta&rsquo; data on the comment.
            </span>
          </p>
          <p class="c3">
            <span class="c5">&nbsp; &nbsp; // For example: user name, email etc&rsquo;</span>
          </p>
          <p class="c3">
            <span class="c5">
              &nbsp; &nbsp; $(&quot;#beerCommentsModal input[id^=&#39;beer&#39;]&quot;).each(function() { &nbsp; &nbsp; &nbsp;
            </span>
          </p>
          <p class="c3">
            <span class="c5">
              &nbsp; &nbsp; &nbsp; features[$(this).attr(&#39;name&#39;)] = $(this).val();
            </span>
          </p>
          <p class="c3">
            <span class="c5">&nbsp; &nbsp; });</span>
          </p>
          <p class="c3 c6">
            <span class="c5"></span>
          </p>
          <p class="c3">
            <span class="c5 c4">
              &nbsp; &nbsp; var req = gapi.client.birra.beers.comments.insert(features);
            </span>
          </p>
          <p class="c3">
            <span class="c5">&nbsp; &nbsp; req.execute(function(data) {</span>
          </p>
          <p class="c3">
            <span class="c5">&nbsp; &nbsp; &nbsp; var tmpHTML;</span>
          </p>
          <p class="c3">
            <span class="c5">
              &nbsp; &nbsp; &nbsp; // first thing we wish to do is to show the user that we got an answer &nbsp;
            </span>
          </p>
          <p class="c3">
            <span class="c5">
              &nbsp; &nbsp; &nbsp; // from the server. So we will remove the spinner from the screen.
            </span>
          </p>
          <p class="c3">
            <span class="c5">&nbsp; &nbsp; &nbsp; $(&quot;#spinner&quot;).remove();</span>
          </p>
          <p class="c3">
            <span class="c5">
              &nbsp; &nbsp; &nbsp; if (data.error &amp;&amp; data.error.code &gt; 200) {
            </span>
          </p>
          <p class="c3">
            <span class="c5">
              &nbsp; &nbsp; &nbsp; &nbsp; console.error(&quot;Err Code: &quot; + data.error.code + &quot; Err: &quot; + data.error.message);
            </span>
          </p>
          <p class="c3">
            <span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; tmpHTML = data.error.message;</span>
          </p>
          <p class="c3">
            <span class="c5">&nbsp; &nbsp; &nbsp; }</span>
          </p>
          <p class="c3">
            <span class="c5">&nbsp; &nbsp; &nbsp; else {</span>
          </p>
          <p class="c3">
            <span class="c5">
              &nbsp; &nbsp; &nbsp; &nbsp; tmpHTML = &#39;&lt;h4&gt;Your great comment on beer &#39; + data.beerId + &#39; is Safe&lt;/h4&gt;&#39;;
            </span>
          </p>
          <p class="c3">
            <span class="c5">
              &nbsp; &nbsp; &nbsp; &nbsp; tmpHTML += &quot;&lt;img src=&#39;img/beer-icon-36.png&#39;/&gt;&quot;
            </span>
          </p>
          <p class="c3">
            <span class="c5">&nbsp; &nbsp; &nbsp; }</span>
          </p>
          <p class="c3">
            <span class="c5">
              &nbsp; &nbsp; &nbsp; $(&#39;#results&#39;).html(&quot;&quot;);
            </span>
          </p>
          <p class="c3">
            <span class="c5">
              &nbsp; &nbsp; &nbsp; $(&#39;#alertContent&#39;).html(tmpHTML);
            </span>
          </p>
          <p class="c3">
            <span class="c5">&nbsp; &nbsp; &nbsp; $(&#39;.alert&#39;).show();</span>
          </p>
          <p class="c3">
            <span class="c5">&nbsp; &nbsp; }); &nbsp;</span>
          </p>
          <p class="c3">
            <span class="c5">
              &nbsp; &nbsp; // Closing our &lsquo;add comment&rsquo; dialog.
            </span>
          </p>
          <p class="c3">
            <span class="c5">
              &nbsp; &nbsp; $(&#39;#beerCommentsModal&#39;).modal(&#39;hide&#39;);
            </span>
          </p>
          <p class="c3">
            <span class="c5">&nbsp; }); &nbsp;</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              In order to get a comment from the server we need to pass a beerId and the server will fetch us all the comments that are associated with it. Here we listen to a click on a button &lsquo;beerComments&rsquo; that will fetch the comments per beer.
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span class="c5">$(&quot;#beerComments&quot;).click(function() {</span>
          </p>
          <p class="c3">
            <span class="c5">&nbsp; &nbsp;</span>
            <span class="c5 c4">&nbsp; var req = gapi.client.birra.beers.comments.list({</span>
          </p>
          <p class="c3">
            <span class="c5">
              &nbsp; &nbsp; &nbsp; &nbsp; &#39;beerId&#39;: $(&quot;#gbeerId&quot;).val() // our current beerId
            </span>
          </p>
          <p class="c3">
            <span class="c5">&nbsp; &nbsp; &nbsp; });</span>
          </p>
          <p class="c3 c6">
            <span class="c5"></span>
          </p>
          <p class="c3">
            <span class="c5">&nbsp; &nbsp; &nbsp; req.execute(function(data) {</span>
          </p>
          <p class="c3">
            <span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; beerApp.showComments(data);</span>
          </p>
          <p class="c3">
            <span class="c5">&nbsp; &nbsp; &nbsp; });</span>
          </p>
          <p class="c3">
            <span class="c5">&nbsp; })</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <h2 class="c3">
            <a name="h.c6jr8nvhh0a6"></a>
            <span>Paging</span>
          </h2>
          <p class="c3">
            <span>
              Now let&rsquo;s look at how to add paging. &nbsp;Today our listBeer() method returns all the beers in the datastore. &nbsp;That is fine for a demo, but we expect this app to be widely successful with 100s of thousands of beers. &nbsp;To prepare for that, we need to add paging support to listBeer() and show off a few more Endpoints features.
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <ol class="c32" start="1">
            <li class="c7 c3">
              <span class="c0">@ApiMethod</span>
              <span class="c0 c1">(</span>
              <span class="c0">name</span>
              <span class="c0 c2">=</span>
              <span class="c0 c10">&quot;beers.list&quot;</span>
              <span class="c0">, path</span>
              <span class="c0 c2">=</span>
              <span class="c0 c10">&quot;beer&quot;</span>
              <span class="c0 c1">)</span>
              <span class="c0">&nbsp; &nbsp; &nbsp;</span>
            </li>
            <li class="c7 c3">
              <span class="c0 c4">public</span>
              <span class="c0">&nbsp;CollectionResponse</span>
              <span class="c0 c2">&lt;</span>
              <span class="c0">Beer</span>
              <span class="c0 c2">&gt;</span>
              <span class="c0">&nbsp;listBeers</span>
              <span class="c0 c1">(</span>
              <span class="c0">@Nullable @Named</span>
              <span class="c0 c1">(</span>
              <span class="c0 c10">&quot;cursor&quot;</span>
              <span class="c0 c1">)</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c16">String</span>
              <span class="c0">&nbsp;cursorString,</span>
            </li>
            <li class="c7 c3">
              <span class="c0">
                &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; @Nullable @Named
              </span>
              <span class="c0 c1">(</span>
              <span class="c0 c10">&quot;limit&quot;</span>
              <span class="c0 c1">)</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c16">Integer</span>
              <span class="c0">&nbsp;limit</span>
              <span class="c0 c1">)</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c1">{</span>
            </li>
          </ol>
          <p class="c3 c6">
            <span class="c0 c1"></span>
          </p>
          <p class="c3">
            <span>
              Above, you see we now have two params. &nbsp;The limit tells us how many beers to return and the cursorString tells us where to pick on iterating through the list using
            </span>
            <span class="c20">
              <a class="c13" href="https://developers.google.com/appengine/docs/java/datastore/queries#Query_Cursors">query cursors.</a>
            </span>
            <span>&nbsp;</span>
          </p>
          <p class="c3 c6">
            <span class="c0 c1"></span>
          </p>
          <p class="c3 c6">
            <span class="c0 c1"></span>
          </p>
          <ol class="c32" start="4">
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PersistenceManager mgr</span>
              <span class="c0 c2">=</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c4 c21">null</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
              <span class="c0 c16">Cursor</span>
              <span class="c0">&nbsp;cursor</span>
              <span class="c0 c2">=</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c4 c21">null</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; List</span>
              <span class="c0 c2">&lt;</span>
              <span class="c0">Beer</span>
              <span class="c0 c2">&gt;</span>
              <span class="c0">&nbsp;execute</span>
              <span class="c0 c2">=</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c4 c21">null</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
              <span class="c0 c4">try</span>
              <span class="c0 c1">{</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mgr</span>
              <span class="c0 c2">=</span>
              <span class="c0">&nbsp;getPersistenceManager</span>
              <span class="c0 c1">()</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Query query</span>
              <span class="c0 c2">=</span>
              <span class="c0">&nbsp;mgr.</span>
              <span class="c0 c17">newQuery</span>
              <span class="c0 c1">(</span>
              <span class="c0">Beer.</span>
              <span class="c0 c4">class</span>
              <span class="c0 c1">)</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
              <span class="c0 c4">if</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c1">(</span>
              <span class="c0">cursorString</span>
              <span class="c0 c2">!=</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c4 c21">null</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c2">&amp;&amp;</span>
              <span class="c0">&nbsp;cursorString</span>
              <span class="c0 c2">!=</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c10">&quot;&quot;</span>
              <span class="c0 c1">)</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c1">{</span>
            </li>
            <li class="c7 c3">
              <span class="c0">
                &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cursor
              </span>
              <span class="c0 c2">=</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c16">Cursor</span>
              <span class="c0">.</span>
              <span class="c0 c17">fromWebSafeString</span>
              <span class="c0 c1">(</span>
              <span class="c0">cursorString</span>
              <span class="c0 c1">)</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">
                &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Map
              </span>
              <span class="c0 c2">&lt;</span>
              <span class="c0 c16">String</span>
              <span class="c0">, Object</span>
              <span class="c0 c2">&gt;</span>
              <span class="c0">&nbsp;extensionMap</span>
              <span class="c0 c2">=</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c4">new</span>
              <span class="c0">&nbsp;HashMap</span>
              <span class="c0 c2">&lt;</span>
              <span class="c0 c16">String</span>
              <span class="c0">, Object</span>
              <span class="c0 c2">&gt;</span>
              <span class="c0 c1">()</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">
                &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;extensionMap.
              </span>
              <span class="c0 c17">put</span>
              <span class="c0 c1">(</span>
              <span class="c0">JDOCursorHelper.</span>
              <span class="c0 c17">CURSOR_EXTENSION</span>
              <span class="c0">, cursor</span>
              <span class="c0 c1">)</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">
                &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;query.
              </span>
              <span class="c0 c17">setExtensions</span>
              <span class="c0 c1">(</span>
              <span class="c0">extensionMap</span>
              <span class="c0 c1">)</span>
              <span class="c0 c2">
                ;
                <br></span>
            </li>
          </ol>
          <p class="c3">
            <span>
              Above we are setting the cursor that was sent in from the client
            </span>
            <span class="c0 c2">
              <br></span>
          </p>
          <ol class="c32" start="15">
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
              <span class="c0 c1">}</span>
            </li>
            <li class="c7 c3">
              <span class="c0">
                &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
              </span>
              <span class="c0 c4">if</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c1">(</span>
              <span class="c0">limit</span>
              <span class="c0 c2">!=</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c4 c21">null</span>
              <span class="c0 c1">)</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c1">{</span>
            </li>
            <li class="c7 c3">
              <span class="c0">
                &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;query.
              </span>
              <span class="c0 c17">setRange</span>
              <span class="c0 c1">(</span>
              <span class="c0 c38">0</span>
              <span class="c0">, limit</span>
              <span class="c0 c1">)</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
              <span class="c0 c1">}</span>
            </li>
          </ol>
          <p class="c3 c6">
            <span class="c0 c1"></span>
          </p>
          <p class="c3">
            <span>
              Above, if the limit is passed it, we set it in our query.. &nbsp;
            </span>
          </p>
          <p class="c3 c6">
            <span class="c0 c1"></span>
          </p>
          <p class="c3 c6">
            <span class="c0 c1"></span>
          </p>
          <ol class="c32" start="19">
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; execute</span>
              <span class="c0 c2">=</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c1">(</span>
              <span class="c0">List</span>
              <span class="c0 c2">&lt;</span>
              <span class="c0">Beer</span>
              <span class="c0 c2">&gt;</span>
              <span class="c0 c1">)</span>
              <span class="c0">&nbsp;query.</span>
              <span class="c0 c17">execute</span>
              <span class="c0 c1">()</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cursor</span>
              <span class="c0 c2">=</span>
              <span class="c0">&nbsp;JDOCursorHelper.</span>
              <span class="c0 c17">getCursor</span>
              <span class="c0 c1">(</span>
              <span class="c0">execute</span>
              <span class="c0 c1">)</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
              <span class="c0 c4">if</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c1">(</span>
              <span class="c0">cursor</span>
              <span class="c0 c2">!=</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c4 c21">null</span>
              <span class="c0 c1">)</span>
              <span class="c0">&nbsp;cursorString</span>
              <span class="c0 c2">=</span>
              <span class="c0">&nbsp;cursor.</span>
              <span class="c0 c17">toWebSafeString</span>
              <span class="c0 c1">()</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
              <span class="c0 c4">else</span>
              <span class="c0">&nbsp;cursorString</span>
              <span class="c0 c2">=</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c10">&quot;&quot;</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
              <span class="c0 c28 c39">
                // Tight loop for fetching all entities from datastore and accomodate
              </span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
              <span class="c0 c28 c39">// for lazy fetch.</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
              <span class="c0 c4">for</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c1">(</span>
              <span class="c0">Beer e</span>
              <span class="c0 c2">:</span>
              <span class="c0">execute</span>
              <span class="c0 c1">)</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
              <span class="c0 c1">}</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c4">finally</span>
              <span class="c0">&nbsp;</span>
              <span class="c0 c1">{</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mgr.</span>
              <span class="c0 c17">close</span>
              <span class="c0 c1">()</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
              <span class="c0 c1">}</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
              <span class="c0 c4">return</span>
              <span class="c0">&nbsp;CollectionResponse.</span>
              <span class="c0 c2">&lt;</span>
              <span class="c0">Beer</span>
              <span class="c0 c2">&gt;</span>
              <span class="c0">builder</span>
              <span class="c0 c1">()</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .</span>
              <span class="c0 c17">setItems</span>
              <span class="c0 c1">(</span>
              <span class="c0">execute</span>
              <span class="c0 c1">)</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .</span>
              <span class="c0 c17">setNextPageToken</span>
              <span class="c0 c1">(</span>
              <span class="c0">cursorString</span>
              <span class="c0 c1">)</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .</span>
              <span class="c0 c17">build</span>
              <span class="c0 c1">()</span>
              <span class="c0 c2">;</span>
            </li>
            <li class="c7 c3">
              <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
              <span class="c0 c1">}</span>
            </li>
          </ol>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              Above we return the results to the client which include all the beers we retrieved and the cursor that indicates where to start from for the next query.. &nbsp;
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>OK, to test this out, let&rsquo;s add in two more beers.</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span class="c4 c8">
              % &nbsp;curl &nbsp;-H &#39;Content-Type: appilcation/json&#39; -d &#39;{&quot;beerName&quot;: &quot;Moms Home brew&quot;}&#39; http://localhost:8888/_ah/api/birra/v1/beer
            </span>
          </p>
          <p class="c3">
            <span class="c4 c8">{</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;id&quot; : 3,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;beerName&quot; : &quot;Moms Home brew&quot;,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;kindOfBeer&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;score&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;numberOfDrinks&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;image&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;country&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;description&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;latitude&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;longitude&quot; : null</span>
          </p>
          <p class="c3">
            <span class="c4 c8">
              }% &nbsp;curl &nbsp;-H &#39;Content-Type: appilcation/json&#39; -d &#39;{&quot;beerName&quot;: &quot;Bobs Indian Pale Ale&quot;}&#39; http:/localhost:8888/_ah/api/birra/v1/beer
            </span>
          </p>
          <p class="c3">
            <span class="c4 c8">{</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;id&quot; : 4,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">
              &nbsp; &quot;beerName&quot; : &quot;Bobs Indian Pale Ale&quot;,
            </span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;kindOfBeer&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;score&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;numberOfDrinks&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;image&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;country&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;description&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;latitude&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;longitude&quot; : null</span>
          </p>
          <p class="c3">
            <span class="c4 c8">}%</span>
          </p>
          <p class="c3 c6">
            <span class="c4 c8"></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>Now when we list, we get all three beers.</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span class="c4 c8">% curl http://localhost:8888/_ah/api/birra/v1/beer{</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;items&quot; : [ {</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;id&quot; : 1,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;beerName&quot; : &quot;bud&quot;,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;kindOfBeer&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;score&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;numberOfDrinks&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;image&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;country&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;description&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;latitude&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;longitude&quot; : null</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; }, {</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;id&quot; : 3,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">
              &nbsp; &nbsp; &quot;beerName&quot; : &quot;Bobs Indian Pale Ale&quot;,
            </span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;kindOfBeer&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;score&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;numberOfDrinks&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;image&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;country&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;description&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;latitude&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;longitude&quot; : null</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; } ],</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;nextPageToken&quot; : &quot;&quot;</span>
          </p>
          <p class="c3">
            <span class="c4 c8">}</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              Notice, we are returning a nextPageToken, but it is empty because default we are returning all the beers. &nbsp;
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              Now, we&rsquo;ll try our limit parameter... &nbsp;It is optional, so it is passed in via a query string. &nbsp;
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span class="c4 c8">% curl http://localhost:8888/_ah/api/birra/v1/beer?limit=1</span>
          </p>
          <p class="c3">
            <span class="c4 c8">{</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;items&quot; : [ {</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;id&quot; : 1,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;beerName&quot; : &quot;bud&quot;,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;kindOfBeer&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;score&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;numberOfDrinks&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;image&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;country&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;description&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;latitude&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;longitude&quot; : null</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; } ],</span>
          </p>
          <p class="c3">
            <span class="c4 c8">
              &nbsp; &quot;nextPageToken&quot; : &quot;E-ABAIICF2oJbm9fYXBwX2lkcgoLEgRCZWVyGAEMFA&quot;
            </span>
          </p>
          <p class="c3">
            <span class="c4 c8">}</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              Notice we have a nextPageToken, let&rsquo;s use that to iterate through and find the next beer.
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span class="c4 c8">
              % curl &#39;http://localhost:8888/_ah/api/birra/v1/beer?limit=1&amp;cursor=E-ABAIICF2oJbm9fYXBwX2lkcoLEgRCZWVyGAEMFA&#39;
            </span>
          </p>
          <p class="c3">
            <span class="c4 c8">{</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;items&quot; : [ {</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;id&quot; : 2,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">
              &nbsp; &nbsp; &quot;beerName&quot; : &quot;Moms Home brew&quot;,
            </span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;kindOfBeer&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;score&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;numberOfDrinks&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;image&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;country&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;description&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;latitude&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;longitude&quot; : null</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; } ],</span>
          </p>
          <p class="c3">
            <span class="c4 c8">
              &nbsp; &quot;nextPageToken&quot; : &quot;E-ABAIICF2oJbm9fYXBwX2lkcgoLEgRCZWVyGAIMFA&quot;
            </span>
          </p>
          <p class="c3">
            <span class="c4 c8">}</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              Great! &nbsp;It is now pretty easy to build out a JavaScript client for this..
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <h2 class="c3">
            <a name="h.7ad8d8nmg8c9"></a>
            <span>Pagination from the Client</span>
          </h2>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              In the client &lsquo;life is good&rsquo;. All we need to implement in order to show off our friend our ability to have pagination is to add to our calls for
            </span>
            <span class="c4">beer.list</span>
            <span>with</span>
            <span class="c4">&nbsp;</span>
            <span>the new parameter:</span>
            <span class="c4 c8">nextPageToken</span>
          </p>
          <p class="c3">
            <span>Once we got in the response a</span>
            <span class="c4 c8">nextPageToken</span>
            <span>&nbsp;we will store it in</span>
            <span class="c4 c5">beerApp.cursor</span>
          </p>
          <p class="c3">
            <span>
              So next time we are calling the list we have its value and the server will fetch us a new set of beers that are align after this mark.
            </span>
          </p>
          <p class="c3">
            <span class="c5">&nbsp;</span>
          </p>
          <p class="c3">
            <span class="c5">
              &nbsp; &nbsp; $(&#39;#results&#39;).html(beerApp.callingServerHtml);
            </span>
          </p>
          <p class="c3">
            <span class="c5">&nbsp; &nbsp; var req = gapi.client.birra.beers.list({</span>
          </p>
          <p class="c3">
            <span class="c5">&nbsp; &nbsp; &nbsp;</span>
            <span class="c5 c4">&#39;cursor&#39;: beerApp.cursor</span>
          </p>
          <p class="c3">
            <span class="c5">&nbsp; &nbsp; });</span>
          </p>
          <p class="c3 c6">
            <span class="c5"></span>
          </p>
          <p class="c3">
            <span class="c5">&nbsp; &nbsp; req.execute(function(data) {</span>
          </p>
          <p class="c3">
            <span class="c5">&nbsp; &nbsp; &nbsp; beerApp.showList(data); &nbsp;</span>
          </p>
          <p class="c3">
            <span class="c5">&nbsp; &nbsp; });</span>
          </p>
          <p class="c3 c6">
            <span class="c5"></span>
          </p>
          <p class="c3">
            <span>you can see in our example how in case we have a value in</span>
            <span class="c5">&nbsp;</span>
            <span class="c4 c8">nextPageToken</span>
            <span>
              we add a new button to the UI &lsquo;More&rsquo; so the user will know she can move to the next page.
            </span>
          </p>
          <p class="c3">
            <span>This is the test</span>
            <span>page</span>
            <span>:</span>
            <span class="c20">
              <a class="c13" href="https://github.com/greenido/backbone-bira/blob/master/test-page/index.html">
                https://github.com/greenido/backbone-bira/blob/master/test-page/index.html
              </a>
            </span>
          </p>
          <p class="c3">
            <span>and it&rsquo;s JavaScript code:</span>
          </p>
          <p class="c3">
            <span class="c20">
              <a class="c13" href="https://github.com/greenido/backbone-bira/blob/master/test-page/js/scripts-gapi.js">
                https://github.com/greenido/backbone-bira/blob/master/test-page/js/scripts-gapi.js
              </a>
            </span>
          </p>
          <p class="c3">
            <span>or test it live at:</span>
          </p>
          <p class="c3">
            <span class="c40">
              <a class="c13" href="http://birra-io2012.appspot.com/test/">http://birra-io2012.appspot.com/test/</a>
            </span>
          </p>
          <p class="c3 c6">
            <span class="c5"></span>
          </p>
          <h2 class="c3">
            <a name="h.qv1ia4lo1o40"></a>
            <span>Search</span>
          </h2>
          <p class="c3">
            <span>
              Now let&rsquo;s take a look at adding Search to our app. &nbsp;We are levearging the power of the underlying infrastructure for google&rsquo;s own search product.
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>The first thing we need to do is setup an index.</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">private</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4">static</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4">final</span>
            <span class="c0">&nbsp;Index INDEX</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;getIndex</span>
            <span class="c0 c1">()</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">private</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4">static</span>
            <span class="c0">&nbsp;Index getIndex</span>
            <span class="c0 c1">()</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">
              &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; IndexSpec indexSpec
            </span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;IndexSpec.</span>
            <span class="c0 c17">newBuilder</span>
            <span class="c0 c1">()</span>
          </p>
          <p class="c3">
            <span class="c0">
              &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .
            </span>
            <span class="c0 c17">setName</span>
            <span class="c0 c1">(</span>
            <span class="c0 c10">&quot;beerindex&quot;</span>
            <span class="c0 c1">)</span>
          </p>
          <p class="c3">
            <span class="c0">
              &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .
            </span>
            <span class="c0 c17">setConsistency</span>
            <span class="c0 c1">(</span>
            <span class="c0">Consistency.</span>
            <span class="c0 c17">PER_DOCUMENT</span>
            <span class="c0 c1">)</span>
          </p>
          <p class="c3">
            <span class="c0">
              &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .
            </span>
            <span class="c0 c17">build</span>
            <span class="c0 c1">()</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">
              &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
            </span>
            <span class="c0 c4">return</span>
            <span class="c0">&nbsp;SearchServiceFactory.</span>
            <span class="c0 c17">getSearchService</span>
            <span class="c0 c1">()</span>
            <span class="c0">.</span>
            <span class="c0 c17">getIndex</span>
            <span class="c0 c1">(</span>
            <span class="c0">indexSpec</span>
            <span class="c0 c1">)</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              Now, we need to add beers to that index. &nbsp;With this code we can customize exactly which fields from the Beer get indexed. &nbsp;Notice as well we are including type information (String or Number) this is used by the query processor to enable some advanced queries we will look at later.
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp;</span>
            <span class="c0 c4">private</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4">static</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4 c21">void</span>
            <span class="c0">&nbsp;addBeerToSearchIndex</span>
            <span class="c0 c1">(</span>
            <span class="c0">Beer b</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c16">Document</span>
            <span class="c0">.</span>
            <span class="c0 c17">Builder</span>
            <span class="c0">&nbsp;docBuilder</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">Document</span>
            <span class="c0">.</span>
            <span class="c0 c17">newBuilder</span>
            <span class="c0 c1">()</span>
          </p>
          <p class="c3">
            <span class="c0">
              &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .
            </span>
            <span class="c0 c17">addField</span>
            <span class="c0 c1">(</span>
            <span class="c0 c16">Field</span>
            <span class="c0">.</span>
            <span class="c0 c17">newBuilder</span>
            <span class="c0 c1">()</span>
            <span class="c0">.</span>
            <span class="c0 c17">setName</span>
            <span class="c0 c1">(</span>
            <span class="c0 c10">&quot;name&quot;</span>
            <span class="c0 c1">)</span>
          </p>
          <p class="c3">
            <span class="c0">
              &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .
            </span>
            <span class="c0 c17">setText</span>
            <span class="c0 c1">(</span>
            <span class="c0">b.</span>
            <span class="c0 c17">getBeerName</span>
            <span class="c0 c1">()</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">!=</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4 c21">null</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">?</span>
            <span class="c0">&nbsp;b.</span>
            <span class="c0 c17">getBeerName</span>
            <span class="c0 c1">()</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">:</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c10">&quot;&quot;</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">))</span>
          </p>
          <p class="c3">
            <span class="c0">
              &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .
            </span>
            <span class="c0 c17">addField</span>
            <span class="c0 c1">(</span>
            <span class="c0 c16">Field</span>
            <span class="c0">.</span>
            <span class="c0 c17">newBuilder</span>
            <span class="c0 c1">()</span>
            <span class="c0">.</span>
            <span class="c0 c17">setName</span>
            <span class="c0 c1">(</span>
            <span class="c0 c10">&quot;id&quot;</span>
            <span class="c0 c1">)</span>
          </p>
          <p class="c3">
            <span class="c0">
              &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .
            </span>
            <span class="c0 c17">setText</span>
            <span class="c0 c1">(</span>
            <span class="c0 c16">Long</span>
            <span class="c0">.</span>
            <span class="c0 c17">toString</span>
            <span class="c0 c1">(</span>
            <span class="c0">b.</span>
            <span class="c0 c17">getId</span>
            <span class="c0 c1">())))</span>
          </p>
          <p class="c3">
            <span class="c0">
              &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .
            </span>
            <span class="c0 c17">addField</span>
            <span class="c0 c1">(</span>
            <span class="c0 c16">Field</span>
            <span class="c0">.</span>
            <span class="c0 c17">newBuilder</span>
            <span class="c0 c1">()</span>
            <span class="c0">.</span>
            <span class="c0 c17">setName</span>
            <span class="c0 c1">(</span>
            <span class="c0 c10">&quot;country&quot;</span>
            <span class="c0 c1">)</span>
          </p>
          <p class="c3">
            <span class="c0">
              &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .
            </span>
            <span class="c0 c17">setText</span>
            <span class="c0 c1">(</span>
            <span class="c0">b.</span>
            <span class="c0 c17">getCountry</span>
            <span class="c0 c1">()</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">!=</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4 c21">null</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">?</span>
            <span class="c0">&nbsp;b.</span>
            <span class="c0 c17">getCountry</span>
            <span class="c0 c1">()</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">:</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c10">&quot;&quot;</span>
            <span class="c0 c1">))</span>
          </p>
          <p class="c3">
            <span class="c0">
              &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .
            </span>
            <span class="c0 c17">addField</span>
            <span class="c0 c1">(</span>
            <span class="c0 c16">Field</span>
            <span class="c0">.</span>
            <span class="c0 c17">newBuilder</span>
            <span class="c0 c1">()</span>
            <span class="c0">.</span>
            <span class="c0 c17">setName</span>
            <span class="c0 c1">(</span>
            <span class="c0 c10">&quot;kind&quot;</span>
            <span class="c0 c1">)</span>
          </p>
          <p class="c3">
            <span class="c0">
              &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .
            </span>
            <span class="c0 c17">setText</span>
            <span class="c0 c1">(</span>
            <span class="c0">b.</span>
            <span class="c0 c17">getKindOfBeer</span>
            <span class="c0 c1">()</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">!=</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4 c21">null</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">?</span>
            <span class="c0">&nbsp;b.</span>
            <span class="c0 c17">getKindOfBeer</span>
            <span class="c0 c1">()</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">:</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c10">&quot;&quot;</span>
            <span class="c0 c1">))</span>
          </p>
          <p class="c3">
            <span class="c0">
              &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .
            </span>
            <span class="c0 c17">addField</span>
            <span class="c0 c1">(</span>
            <span class="c0 c16">Field</span>
            <span class="c0">.</span>
            <span class="c0 c17">newBuilder</span>
            <span class="c0 c1">()</span>
            <span class="c0">.</span>
            <span class="c0 c17">setName</span>
            <span class="c0 c1">(</span>
            <span class="c0 c10">&quot;latitude&quot;</span>
            <span class="c0 c1">)</span>
          </p>
          <p class="c3">
            <span class="c0">
              &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .
            </span>
            <span class="c0 c17">setNumber</span>
            <span class="c0 c1">(</span>
            <span class="c0">b.</span>
            <span class="c0 c17">getLatitude</span>
            <span class="c0 c1">()</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">!=</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4 c21">null</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">?</span>
            <span class="c0">&nbsp;b.</span>
            <span class="c0 c17">getLatitude</span>
            <span class="c0 c1">()</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">:</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c38">0</span>
            <span class="c0 c1">))</span>
          </p>
          <p class="c3">
            <span class="c0">
              &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .
            </span>
            <span class="c0 c17">addField</span>
            <span class="c0 c1">(</span>
            <span class="c0 c16">Field</span>
            <span class="c0">.</span>
            <span class="c0 c17">newBuilder</span>
            <span class="c0 c1">()</span>
            <span class="c0">.</span>
            <span class="c0 c17">setName</span>
            <span class="c0 c1">(</span>
            <span class="c0 c10">&quot;longitude&quot;</span>
            <span class="c0 c1">)</span>
          </p>
          <p class="c3">
            <span class="c0">
              &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .
            </span>
            <span class="c0 c17">setNumber</span>
            <span class="c0 c1">(</span>
            <span class="c0">b.</span>
            <span class="c0 c17">getLongitude</span>
            <span class="c0 c1">()</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">!=</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4 c21">null</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">?</span>
            <span class="c0">&nbsp;b.</span>
            <span class="c0 c17">getLongitude</span>
            <span class="c0 c1">()</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">:</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c38">0</span>
            <span class="c0 c1">))</span>
          </p>
          <p class="c3">
            <span class="c0">
              &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .
            </span>
            <span class="c0 c17">addField</span>
            <span class="c0 c1">(</span>
            <span class="c0 c16">Field</span>
            <span class="c0">.</span>
            <span class="c0 c17">newBuilder</span>
            <span class="c0 c1">()</span>
            <span class="c0">.</span>
            <span class="c0 c17">setName</span>
            <span class="c0 c1">(</span>
            <span class="c0 c10">&quot;description&quot;</span>
            <span class="c0 c1">)</span>
          </p>
          <p class="c3">
            <span class="c0">
              &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .
            </span>
            <span class="c0 c17">setText</span>
            <span class="c0 c1">(</span>
            <span class="c0">b.</span>
            <span class="c0 c17">getDescription</span>
            <span class="c0 c1">()</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">!=</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4 c21">null</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">?</span>
            <span class="c0">&nbsp;b.</span>
            <span class="c0 c17">getDescription</span>
            <span class="c0 c1">()</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">:</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c10">&quot;&quot;</span>
            <span class="c0 c1">))</span>
          </p>
          <p class="c3">
            <span class="c0">
              &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .
            </span>
            <span class="c0 c17">addField</span>
            <span class="c0 c1">(</span>
            <span class="c0 c16">Field</span>
            <span class="c0">.</span>
            <span class="c0 c17">newBuilder</span>
            <span class="c0 c1">()</span>
            <span class="c0">.</span>
            <span class="c0 c17">setName</span>
            <span class="c0 c1">(</span>
            <span class="c0 c10">&quot;score&quot;</span>
            <span class="c0 c1">)</span>
          </p>
          <p class="c3">
            <span class="c0">
              &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .
            </span>
            <span class="c0 c17">setNumber</span>
            <span class="c0 c1">(</span>
            <span class="c0">b.</span>
            <span class="c0 c17">getScore</span>
            <span class="c0 c1">()</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">!=</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4 c21">null</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">?</span>
            <span class="c0">&nbsp;b.</span>
            <span class="c0 c17">getScore</span>
            <span class="c0 c1">()</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">:</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c38">0</span>
            <span class="c0 c1">))</span>
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
          </p>
          <p class="c3">
            <span class="c0">
              &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .
            </span>
            <span class="c0 c17">addField</span>
            <span class="c0 c1">(</span>
            <span class="c0 c16">Field</span>
            <span class="c0">.</span>
            <span class="c0 c17">newBuilder</span>
            <span class="c0 c1">()</span>
            <span class="c0">.</span>
            <span class="c0 c17">setName</span>
            <span class="c0 c1">(</span>
            <span class="c0 c10">&quot;numberOfDrinks&quot;</span>
            <span class="c0 c1">)</span>
          </p>
          <p class="c3">
            <span class="c0">
              &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .
            </span>
            <span class="c0 c17">setNumber</span>
            <span class="c0 c1">(</span>
            <span class="c0">b.</span>
            <span class="c0 c17">getNumberOfDrinks</span>
            <span class="c0 c1">()</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">!=</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4 c21">null</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">?</span>
            <span class="c0">&nbsp;b.</span>
            <span class="c0 c17">getNumberOfDrinks</span>
            <span class="c0 c1">()</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">:</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c38">0</span>
            <span class="c0 c1">))</span>
            <span class="c0">&nbsp;</span>
          </p>
          <p class="c3">
            <span class="c0">
              &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .
            </span>
            <span class="c0 c17">addField</span>
            <span class="c0 c1">(</span>
            <span class="c0 c16">Field</span>
            <span class="c0">.</span>
            <span class="c0 c17">newBuilder</span>
            <span class="c0 c1">()</span>
            <span class="c0">.</span>
            <span class="c0 c17">setName</span>
            <span class="c0 c1">(</span>
            <span class="c0 c10">&quot;published&quot;</span>
            <span class="c0 c1">)</span>
          </p>
          <p class="c3">
            <span class="c0">
              &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .
            </span>
            <span class="c0 c17">setDate</span>
            <span class="c0 c1">(</span>
            <span class="c0 c16">Field</span>
            <span class="c0">.</span>
            <span class="c0 c17">date</span>
            <span class="c0 c1">(</span>
            <span class="c0 c4">new</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">Date</span>
            <span class="c0 c1">())))</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; docBuilder.</span>
            <span class="c0 c17">setId</span>
            <span class="c0 c1">(</span>
            <span class="c0 c16">Long</span>
            <span class="c0">.</span>
            <span class="c0 c17">toString</span>
            <span class="c0 c1">(</span>
            <span class="c0">b.</span>
            <span class="c0 c17">getId</span>
            <span class="c0 c1">()))</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c16">Document</span>
            <span class="c0">&nbsp;doc</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;docBuilder.</span>
            <span class="c0 c17">build</span>
            <span class="c0 c1">()</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; INDEX.</span>
            <span class="c0 c17">add</span>
            <span class="c0 c1">(</span>
            <span class="c0">doc</span>
            <span class="c0 c1">)</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              Then we simply call addBeerToSearchIndex() from insertBeer() and updateBeer(). &nbsp;In delete, we need to remove the beer from the index. &nbsp;
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp;</span>
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;Beer insertBeer</span>
            <span class="c0 c1">(</span>
            <span class="c0">Beer beer</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; PersistenceManager mgr</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;getPersistenceManager</span>
            <span class="c0 c1">()</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp;</span>
            <span class="c0 c4">try</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; mgr.</span>
            <span class="c0 c17">makePersistent</span>
            <span class="c0 c1">(</span>
            <span class="c0">beer</span>
            <span class="c0 c1">)</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4">finally</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; mgr.</span>
            <span class="c0 c17">close</span>
            <span class="c0 c1">()</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; addBeerToSearchIndex</span>
            <span class="c0 c1">(</span>
            <span class="c0">beer</span>
            <span class="c0 c1">)</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp;</span>
            <span class="c0 c4">return</span>
            <span class="c0">&nbsp;beer</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp;</span>
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;Beer updateBeer</span>
            <span class="c0 c1">(</span>
            <span class="c0">Beer beer</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; PersistenceManager mgr</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;getPersistenceManager</span>
            <span class="c0 c1">()</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp;</span>
            <span class="c0 c4">try</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; mgr.</span>
            <span class="c0 c17">makePersistent</span>
            <span class="c0 c1">(</span>
            <span class="c0">beer</span>
            <span class="c0 c1">)</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4">finally</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; mgr.</span>
            <span class="c0 c17">close</span>
            <span class="c0 c1">()</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; addBeerToSearchIndex</span>
            <span class="c0 c1">(</span>
            <span class="c0">beer</span>
            <span class="c0 c1">)</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp;</span>
            <span class="c0 c4">return</span>
            <span class="c0">&nbsp;beer</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp;</span>
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;Beer removeBeer</span>
            <span class="c0 c1">(</span>
            <span class="c0">@Named</span>
            <span class="c0 c1">(</span>
            <span class="c0 c10">&quot;id&quot;</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">Long</span>
            <span class="c0">&nbsp;id</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; PersistenceManager mgr</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;getPersistenceManager</span>
            <span class="c0 c1">()</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp;Beer beer &nbsp;</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4 c21">null</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp;</span>
            <span class="c0 c4">try</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; beer</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;mgr.</span>
            <span class="c0 c17">getObjectById</span>
            <span class="c0 c1">(</span>
            <span class="c0">Beer.</span>
            <span class="c0 c4">class</span>
            <span class="c0">, id</span>
            <span class="c0 c1">)</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; mgr.</span>
            <span class="c0 c17">deletePersistent</span>
            <span class="c0 c1">(</span>
            <span class="c0">beer</span>
            <span class="c0 c1">)</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4">finally</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; mgr.</span>
            <span class="c0 c17">close</span>
            <span class="c0 c1">()</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; INDEX.</span>
            <span class="c0 c17">remove</span>
            <span class="c0 c1">(</span>
            <span class="c0">beer.</span>
            <span class="c0 c17">getId</span>
            <span class="c0 c1">()</span>
            <span class="c0">.</span>
            <span class="c0 c17">toString</span>
            <span class="c0 c1">())</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp;</span>
            <span class="c0 c4">return</span>
            <span class="c0">&nbsp;beer</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              Now, we have a beers in the index, we need to expose a way for search. &nbsp;For that we will add a new Endpoint for search. &nbsp;Notice we are customizing the &nbsp;HTTP method here as well as the name and path. &nbsp;
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span class="c0">@ApiMethod</span>
            <span class="c0 c1">(</span>
            <span class="c0">httpMethod</span>
            <span class="c0 c2">=</span>
            <span class="c0 c10">&quot;GET&quot;</span>
            <span class="c0">, name</span>
            <span class="c0 c2">=</span>
            <span class="c0 c10">&quot;beer.search&quot;</span>
            <span class="c0 c1">)</span>
          </p>
          <p class="c3">
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;List</span>
            <span class="c0 c2">&lt;</span>
            <span class="c0">Beer</span>
            <span class="c0 c2">&gt;</span>
            <span class="c0">&nbsp;searchBeer</span>
            <span class="c0 c1">(</span>
            <span class="c0">@Named</span>
            <span class="c0 c1">(</span>
            <span class="c0 c10">&quot;term&quot;</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">String</span>
            <span class="c0">&nbsp;queryString</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; List</span>
            <span class="c0 c2">&lt;</span>
            <span class="c0">Beer</span>
            <span class="c0 c2">&gt;</span>
            <span class="c0">&nbsp;beerList</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4">new</span>
            <span class="c0">&nbsp;ArrayList</span>
            <span class="c0 c2">&lt;</span>
            <span class="c0">Beer</span>
            <span class="c0 c2">&gt;</span>
            <span class="c0 c1">()</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; Results</span>
            <span class="c0 c2">&lt;</span>
            <span class="c0">ScoredDocument</span>
            <span class="c0 c2">&gt;</span>
            <span class="c0">&nbsp;results</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;INDEX.</span>
            <span class="c0 c17">search</span>
            <span class="c0 c1">(</span>
            <span class="c0">queryString</span>
            <span class="c0 c1">)</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">for</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">(</span>
            <span class="c0">ScoredDocument scoredDoc</span>
            <span class="c0 c2">:</span>
            <span class="c0">&nbsp;results</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c16">Field</span>
            <span class="c0">&nbsp;f</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;scoredDoc.</span>
            <span class="c0 c17">getOnlyField</span>
            <span class="c0 c1">(</span>
            <span class="c0 c10">&quot;id&quot;</span>
            <span class="c0 c1">)</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">if</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">(</span>
            <span class="c0">f</span>
            <span class="c0 c2">==</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4 c21">null</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">||</span>
            <span class="c0">&nbsp;f.</span>
            <span class="c0 c17">getText</span>
            <span class="c0 c1">()</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">==</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4 c21">null</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4">continue</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4 c21">long</span>
            <span class="c0">&nbsp;beerId</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">Long</span>
            <span class="c0">.</span>
            <span class="c0 c17">parseLong</span>
            <span class="c0 c1">(</span>
            <span class="c0">f.</span>
            <span class="c0 c17">getText</span>
            <span class="c0 c1">())</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">if</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">(</span>
            <span class="c0">beerId</span>
            <span class="c0 c2">!=</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c2">-</span>
            <span class="c0 c38">1</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">
              &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Beer b
            </span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;getBeer</span>
            <span class="c0 c1">(</span>
            <span class="c0">beerId</span>
            <span class="c0 c1">)</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">
              &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; beerList.
            </span>
            <span class="c0 c17">add</span>
            <span class="c0 c1">(</span>
            <span class="c0">b</span>
            <span class="c0 c1">)</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp;</span>
            <span class="c0 c4">return</span>
            <span class="c0">&nbsp;beerList</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">}</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              Now we can test that out. &nbsp; As we add items we see the search engine spin up.
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span class="c4 c8">
              % curl &nbsp; -H &#39;Content-Type: appilcation/json&#39; -d &#39;{&quot;description&quot;: &quot;cool beer&quot;}&#39; http://localhst:8888/_ah/api/birra/v1/beer
            </span>
          </p>
          <p class="c3">
            <span class="c4 c8">{</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;id&quot; : 5,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;beerName&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;kindOfBeer&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;score&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;numberOfDrinks&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;image&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;country&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;description&quot; : &quot;cool beer&quot;,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;latitude&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;longitude&quot; : null</span>
          </p>
          <p class="c3">
            <span class="c4 c8">}</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>Now we can search for that beer and we get it. &nbsp;</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span class="c4 c8">% curl &nbsp;</span>
            <span class="c20 c4 c8">
              <a class="c13" href="http://localhost:8888/_ah/api/birra/v1/searchBeer/coo">http://localhost:8888/_ah/api/birra/v1/searchBeer/cool</a>
            </span>
          </p>
          <p class="c3">
            <span class="c4 c8">{</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;items&quot; : [ {</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;id&quot; : 4,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;beerName&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;kindOfBeer&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;score&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;numberOfDrinks&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;image&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;country&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">
              &nbsp; &nbsp; &quot;description&quot; : &quot;cool beer&quot;,
            </span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;latitude&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;longitude&quot; : null</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; } ]</span>
          </p>
          <p class="c3">
            <span class="c4 c8">}</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              For more fun, let&rsquo;s add a few beers with different scores.
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span class="c4 c8">
              % curl &nbsp; -H &#39;Content-Type: appilcation/json&#39; -d &#39;{&quot;score&quot;: &quot;10&quot;}&#39; http://localhost:8888/_ah/api/birra/v1/beer
            </span>
          </p>
          <p class="c3">
            <span class="c4 c8">{</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;id&quot; : 1,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;beerName&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;kindOfBeer&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;score&quot; : 10,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;numberOfDrinks&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;image&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;country&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;description&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;latitude&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;longitude&quot; : null</span>
          </p>
          <p class="c3">
            <span class="c4 c8">}</span>
          </p>
          <p class="c3">
            <span class="c4 c8">
              % curl &nbsp;-H &#39;Content-Type: appilcation/json&#39; -d &#39;{&quot;score&quot;: &quot;9&quot;}&#39; http://localhost:8888/_ah/ap/birra/v1/beer
            </span>
          </p>
          <p class="c3">
            <span class="c4 c8">{</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;id&quot; : 2,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;beerName&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;kindOfBeer&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;score&quot; : 9,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;numberOfDrinks&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;image&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;country&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;description&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;latitude&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;longitude&quot; : null</span>
          </p>
          <p class="c3">
            <span class="c4 c8">}</span>
          </p>
          <p class="c3">
            <span class="c4 c8">
              % curl &nbsp;-H &#39;Content-Type: appilcation/json&#39; -d &#39;{&quot;score&quot;: &quot;11&quot;}&#39; http://localhost:8888/_ah/ai/birra/v1/beer
            </span>
          </p>
          <p class="c3">
            <span class="c4 c8">{</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;id&quot; : 3,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;beerName&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;kindOfBeer&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;score&quot; : 11,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;numberOfDrinks&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;image&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;country&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;description&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;latitude&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;longitude&quot; : null</span>
          </p>
          <p class="c3">
            <span class="c4 c8">}</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              Now that we have those beers, we can search for score=10 or even score&lt;10... this combined with boolean operators can create some really powerful query functionality.
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span class="c4 c8">
              % curl &nbsp;&#39;http://localhost:8888/_ah/api/birra/v1/searchBeer/score=10&#39;
            </span>
          </p>
          <p class="c3">
            <span class="c4 c8">{</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;items&quot; : [ {</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;id&quot; : 1,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;beerName&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;kindOfBeer&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;score&quot; : 10,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;numberOfDrinks&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;image&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;country&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;description&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;latitude&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;longitude&quot; : null</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; } ]</span>
          </p>
          <p class="c3">
            <span class="c4 c8">}</span>
          </p>
          <p class="c3">
            <span class="c4 c8">
              % curl &nbsp;&#39;http://localhost:8888/_ah/api/birra/v1/searchBeer/score&gt;10&#39;
            </span>
          </p>
          <p class="c3">
            <span class="c4 c8">{</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;items&quot; : [ {</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;id&quot; : 3,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;beerName&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;kindOfBeer&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;score&quot; : 11,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;numberOfDrinks&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;image&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;country&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;description&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;latitude&quot; : null,</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;longitude&quot; : null</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; } ]</span>
          </p>
          <p class="c3">
            <span class="c4 c8">}</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>Now, let&rsquo;s look at the client</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <h2 class="c3">
            <a name="h.7sitcc1o1nit"></a>
            <span>Searching from the Client</span>
          </h2>
          <p class="c3">
            <span class="c27 c28">&ldquo;</span>
            <span class="c27 c28">Yep: simplicity is the ultimate sophistication&rdquo;</span>
          </p>
          <p class="c3">
            <span class="c27">
              In our web app we can have the power of search with few lines of JavaScript. Let&rsquo;s have a look at the code below. You can see that we are listening to an event of a &lsquo;keydown&rsquo; so when the user click on &lsquo;enter&rsquo; we wish to start the search. Then, all we need is to take the &lsquo;term&rsquo; and pass it to:
            </span>
          </p>
          <p class="c3">
            <span class="c15 c4">gapi.client.birra.beer.search( {</span>
            <span class="c23 c4 c37">&#39;term&#39;</span>
            <span class="c15 c4">&nbsp;: searchTerm});</span>
          </p>
          <p class="c3 c6">
            <span class="c27"></span>
          </p>
          <p class="c3">
            <span class="c11">//</span>
          </p>
          <p class="c3">
            <span class="c11">// Search after (good) beers</span>
          </p>
          <p class="c3">
            <span class="c11">//</span>
          </p>
          <p class="c3">
            <span class="c15">$(</span>
            <span class="c23 c37">&quot;#searchBeer&quot;</span>
            <span class="c15">).keydown(</span>
            <span class="c15 c4">function</span>
            <span class="c15">(event) {</span>
          </p>
          <p class="c3">
            <span class="c15">&nbsp;</span>
            <span class="c4 c15">if</span>
            <span class="c15">&nbsp;(event.which</span>
            <span class="c15 c4">==</span>
            <span class="c15">&nbsp;</span>
            <span class="c23 c51">13</span>
            <span class="c15">) {</span>
          </p>
          <p class="c3">
            <span class="c15">&nbsp; &nbsp; &nbsp;</span>
            <span class="c15 c4">var</span>
            <span class="c15">&nbsp;searchTerm</span>
            <span class="c15 c4">=</span>
            <span class="c15">&nbsp;$(</span>
            <span class="c23 c37">&quot;#searchBeer&quot;</span>
            <span class="c15">).val();</span>
          </p>
          <p class="c3">
            <span class="c15">&nbsp; &nbsp; &nbsp; $(</span>
            <span class="c23 c37">&#39;#results&#39;</span>
            <span class="c15">).html(beerApp.callingServerHtml);</span>
          </p>
          <p class="c3">
            <span class="c15">&nbsp; &nbsp; &nbsp;</span>
            <span class="c15 c4">var</span>
            <span class="c15">&nbsp;req</span>
            <span class="c15 c4">=</span>
            <span class="c15">&nbsp;gapi.client.birra.beer.search( {</span>
            <span class="c23 c37">&#39;term&#39;</span>
            <span class="c15">&nbsp;</span>
            <span class="c15 c4">:</span>
            <span class="c15">&nbsp;searchTerm});</span>
          </p>
          <p class="c3">
            <span class="c15">&nbsp; &nbsp; &nbsp; req.execute(</span>
            <span class="c15 c4">function</span>
            <span class="c15">(searchOutput) {</span>
          </p>
          <p class="c3">
            <span class="c15">&nbsp; &nbsp; &nbsp; &nbsp; beerApp.showList(searchOutput);</span>
          </p>
          <p class="c3">
            <span class="c15">&nbsp; &nbsp; &nbsp; });</span>
          </p>
          <p class="c3">
            <span class="c15">&nbsp; }</span>
          </p>
          <p class="c3">
            <span class="c15">});</span>
          </p>
          <p class="c3 c6">
            <span class="c27"></span>
          </p>
          <p class="c3">
            <span class="c27">
              On the results we will get a list of items that match your query. You can do some clever things like, geo query of beers around your current location:
            </span>
          </p>
          <p class="c3">
            <span class="c23 c35">
              latitude &nbsp;&lt; curLoc.lat + 0.5 &nbsp;&amp;&amp;
              <br>
              latitude &nbsp;&gt; curLoc.lat - 0.5 &nbsp;&amp;&amp;
              <br>
              longitude &lt; curLoc.long + 0.5 &amp;&amp;
              <br>
              longitude &gt; curLoc.long - 0.5
              <br></span>
          </p>
          <p class="c3">
            <span class="c23 c35">&nbsp; &nbsp; &nbsp;</span>
          </p>
          <p class="c3 c6">
            <span class="c27"></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span class="c4 c29">Security</span>
          </p>
          <p class="c3 c6">
            <span class="c4 c29"></span>
          </p>
          <p class="c3">
            <span>
              The last area to cover is security. &nbsp; We want to ensure that only authenticated users can post comments. &nbsp; So first we add a client ID from the
            </span>
            <span class="c20">
              <a class="c13" href="https://code.google.com/apis/console/">Google APIs Console</a>
            </span>
            <span>
              . &nbsp;This will be shared with the JavaScript client. &nbsp; Then we specify the OAuth scope we need, in this case the email scope. &nbsp;Finally Endpoints injects the user object with the currently logged on user. &nbsp;
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span class="c0">@ApiMethod</span>
            <span class="c0 c1">(</span>
            <span class="c0">name</span>
            <span class="c0 c2">=</span>
            <span class="c0 c10">&quot;beers.comments.insert&quot;</span>
            <span class="c0">,</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;path</span>
            <span class="c0 c2">=</span>
            <span class="c0 c10">&quot;beers/{beerId}/comments&quot;</span>
            <span class="c0">,</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;clientIds</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
            <span class="c0 c10">&quot;AIzaSyAlZqy1ElhVN_Hbutey0xNabhZ14bEpcAo&quot;</span>
            <span class="c0 c1">}</span>
            <span class="c0">,</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;scopes</span>
            <span class="c0 c2">=</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
            <span class="c0 c10">&quot;https://www.googleapis.com/auth/userinfo.email&quot;</span>
            <span class="c0 c1">})</span>
          </p>
          <p class="c3">
            <span class="c0 c4">public</span>
            <span class="c0">&nbsp;Comment insertComment</span>
            <span class="c0 c1">(</span>
            <span class="c0">@Named</span>
            <span class="c0 c1">(</span>
            <span class="c0 c10">&quot;beerId&quot;</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">Long</span>
            <span class="c0">&nbsp;beerId, Comment comment, User user</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4">throws</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c16">Exception</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">{</span>
          </p>
          <p class="c3">
            <span class="c0">&nbsp; &nbsp;</span>
            <span class="c0 c4">if</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c1">(</span>
            <span class="c0">user</span>
            <span class="c0 c2">==</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4 c21">null</span>
            <span class="c0 c1">)</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4">throw</span>
            <span class="c0">&nbsp;</span>
            <span class="c0 c4">new</span>
            <span class="c0">&nbsp;UnauthorizedException</span>
            <span class="c0 c1">(</span>
            <span class="c0 c10">&quot;Must log in&quot;</span>
            <span class="c0 c1">)</span>
            <span class="c0 c2">;</span>
          </p>
          <p class="c3">
            <span class="c0 c2">&nbsp; &nbsp;</span>
            <span class="c23">comment.setUser(user);</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              Trying thing from the command line generates the exception as expected. &nbsp;
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span class="c4 c8">
              % curl -H &#39;Content-Type: application/json&#39; -d &#39;{&quot;beerId&quot;: &quot;1&quot;, &quot;comment&quot;: &quot;nice head&quot;}&#39; http://localhost:8888/_ah/api/birra/v1/beers/1/comments
            </span>
          </p>
          <p class="c3">
            <span class="c4 c8">{</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &quot;error&quot; : {</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; &nbsp; &quot;message&quot; : &quot;Must log in&quot;</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; }</span>
          </p>
          <p class="c3">
            <span class="c4 c8">}</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              But from API Explorer, once we login, we get the right user info.
            </span>
          </p>
          <p class="c3">
            <span>First we have to authenticate... &nbsp;</span>
          </p>
          <p class="c3">
            <img height="271" src="images/image11.png" width="665"></p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>We give the OAuth scope from our @Api annotation... &nbsp;</span>
          </p>
          <p class="c3">
            <img height="376" src="images/image12.png" width="605"></p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              And we get the results. &nbsp;Notice my email address is filled in correctly. &nbsp;
            </span>
          </p>
          <p class="c3">
            <img height="466" src="images/image14.png" width="673"></p>
          <p class="c3 c6">
            <span></span>
          </p>
          <h2 class="c3">
            <a name="h.1wr94s81kt7d"></a>
            <span>Authentication from the client</span>
          </h2>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span class="c27">
              The basic flow of OAuth 2.0 in the JavaScript client is as follows:
            </span>
          </p>
          <ol class="c22" start="1">
            <li class="c12 c3">
              <span class="c27">User clicks a &quot;login&quot; link.</span>
            </li>
            <li class="c12 c3">
              <span class="c27">
                Browser shows a popup that allows the user to authenticate and authorize your web app.
              </span>
            </li>
            <li class="c3 c12">
              <span class="c27">
                After successful authorization, the browser redirects the user back to the calling app (your app).
              </span>
            </li>
            <li class="c12 c3">
              <span class="c27">
                The callback saves the authorization token and closes the popup. The user is now authorized to use your app!
              </span>
            </li>
          </ol>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>// called at the initialization of our web app</span>
          </p>
          <p class="c3">
            <span class="c23 c35">
              function handleClientLoad() {
              <br>
              &nbsp;gapi.client.setApiKey(apiKey);
              <br>
              &nbsp;window.setTimeout(checkAuth,1);
              <br>
              }
              <br></span>
          </p>
          <p class="c3">
            <span class="c35">
              // called to check if we are authorized with a specific permission that defined in &lsquo;scope&rsquo;. In our example we wish to get the user&rsquo;s email so it will serve us when she adding a new comment.
            </span>
            <span class="c23 c35">
              <br>
              function checkAuth() {
              <br>
              &nbsp;gapi.auth.authorize({client_id: clientId,
              <br>
              &nbsp; &nbsp;scope: scopes, immediate: true}, handleAuthResult);
              <br>
              }
              <br></span>
          </p>
          <p class="c3">
            <span class="c35">
              // Handling the actions on cases where the user is already &lsquo;logged in&rsquo; and approve us to &lsquo;know&rsquo; their email. In that case, there is no point to add them to &lsquo;authorize&rsquo; the app.
            </span>
            <span class="c23 c35">
              <br>
              function handleAuthResult(authResult) {
              <br>
              &nbsp;var authorizeButton = document.getElementById(&#39;authorize-button&#39;);
              <br>
              &nbsp;if (authResult) {
              <br>
              &nbsp; &nbsp;authorizeButton.style.visibility = &#39;hidden&#39;;
              <br>
              &nbsp; &nbsp;insertComment();
              <br>
              &nbsp;} else {
              <br>
              &nbsp; &nbsp;authorizeButton.style.visibility = &#39;&#39;;
              <br>
              &nbsp; &nbsp;authorizeButton.onclick = handleAuthClick;
              <br>
              &nbsp;}
              <br>
              }
              <br></span>
          </p>
          <p class="c3">
            <span class="c35">
              // Handle the action when the user wish to start the &lsquo;OAuth dance&rsquo;. This will call the user account and open a pop-up window that will show the user what app is requesting which permissions. From here is they &lsquo;agree&rsquo; we will get the ability to add comments with their email.
            </span>
            <span class="c23 c35">
              <br>
              function handleAuthClick(event) {
              <br>
              &nbsp;gapi.auth.authorize({client_id: clientId,
              <br>
              &nbsp; &nbsp;scope: scopes, immediate: false}, handleAuthResult);
              <br>
              &nbsp;return false;
              <br>
              }
              <br>
              &nbsp; &nbsp; &nbsp;
              <br></span>
          </p>
          <p class="c3">
            <span>
              Here is an example of a comment that we are adding without permissions to get the user&rsquo;s email:
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span class="c25">{</span>
          </p>
          <p class="c3">
            <span class="c25">&quot;commentId&quot;:</span>
            <span class="c25 c41">23002</span>
            <span class="c25">,</span>
          </p>
          <p class="c3">
            <span class="c25">&quot;user&quot;:</span>
            <span class="c25 c36">null</span>
            <span class="c25">,</span>
          </p>
          <p class="c3">
            <span class="c25">&quot;date&quot;:</span>
            <span class="c25 c36">null</span>
            <span class="c25">,</span>
          </p>
          <p class="c3">
            <span class="c25">&quot;beerId&quot;:</span>
            <span class="c25 c41">6008</span>
            <span class="c25">,</span>
          </p>
          <p class="c3">
            <span class="c25">&quot;comment&quot;:</span>
            <span class="c25 c47">&quot;I want a drink&quot;</span>
            <span class="c25">,</span>
          </p>
          <p class="c3">
            <span class="c25">&quot;etag&quot;:</span>
            <span class="c25 c47">
              &quot;\&quot;fQ6sM7LCuUUYcU5LIaq0IrnKECo/W6k8nbDP-T9StSHXQg5D9u2ieE8\&quot;&quot;
            </span>
          </p>
          <p class="c3">
            <span class="c25">}</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>When we have permissions it will look like:</span>
          </p>
          <p class="c3">
            <span class="c27 c43">commentId: 37001</span>
          </p>
          <p class="c3">
            <span class="c43 c27">user: [object Object]</span>
          </p>
          <p class="c3">
            <span class="c43 c27">(Jul 4 2012 1:9PM)</span>
          </p>
          <p class="c3">
            <span class="c43 c27">comment: Good one!</span>
          </p>
          <p class="c3">
            <span class="c43 c27">user email: your-email@google.com</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span class="c4 c29">Production Deployment</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              Now we are ready to deploy to production. &nbsp;We select the deploy to app engine
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <img height="260" src="images/image07.png" width="450"></p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>Then give it an appid (created from</span>
            <span class="c20">
              <a class="c13" href="http://appengine.google.com">http://appengine.google.com</a>
            </span>
            <span>)</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <img height="362" src="images/image15.png" width="465"></p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <img height="400" src="images/image10.png" width="640"></p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>Total deployment time took about 1 min. &nbsp;</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>Now we test the app out -</span>
            <span class="c20">
              <a class="c13" href="http://birra-io2012.appspot.com/">http://birra-io2012.appspot.com/</a>
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <img height="374" src="images/image04.png" width="602"></p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              And now, we are ready to do some load testing... &nbsp; As a quick and dirty technique, I used ab (apache bench) to spin up several concurrent requests. &nbsp; The load time is actually very interesting. &nbsp; From a hardwired connection here at the conference I am getting &nbsp;some good results.
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span class="c4 c8">% ab -n9000 -c100</span>
            <span class="c20 c4 c8">
              <a class="c13" href="http://birra-io2012.appspot.com/">http://birra-io2012.appspot.com/</a>
            </span>
          </p>
          <p class="c3 c6">
            <span class="c4 c8"></span>
          </p>
          <p class="c3">
            <span class="c4 c8">Percentage of the requests served within a certain time (ms)</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; 50% &nbsp; &nbsp; 57</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; 66% &nbsp; &nbsp; 57</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; 75% &nbsp; &nbsp; 57</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; 80% &nbsp; &nbsp; 58</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; 90% &nbsp; &nbsp; 58</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; 95% &nbsp; &nbsp; 59</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; 98% &nbsp; &nbsp; 65</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp; 99% &nbsp; &nbsp;441</span>
          </p>
          <p class="c3">
            <span class="c4 c8">&nbsp;100% &nbsp; &nbsp;590 (longest request)</span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              That means 98% of the requests are returning within 65 ms... that is very fast! &nbsp;Mostly because we are hitting google&rsquo;s distributed output caching that you get as part of app engine. &nbsp;
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>
              After a few machines doing this sort of load testing, I was able to drive up the queries per second to about 6,000 queries per second. &nbsp;That is 360,000 r
            </span>
            <span>equests every minute</span>
            <span>
              &nbsp;or 518,400,000 requests a day!... which is a lot of unique users!
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <img height="401" src="images/image18.png" width="800"></p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>Nice, ahh?</span>
          </p>
          <p class="c3">
            <span>In case you miss the first part of this series</span>
          </p>
          <p class="c3">
            <span class="c20">
              <a class="c13" href="http://greenido.wordpress.com/2012/06/22/modern-web-apps-at-scale-with-google-app-engine-part-1-out-of-3/">
                http://greenido.wordpress.com/2012/06/22/modern-web-apps-at-scale-with-google-app-engine-part-1-out-of-3/
              </a>
            </span>
          </p>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>More Resources:</span>
          </p>
          <ol class="c22" start="1">
            <li class="c3 c14">
              <span class="c18">A</span>
              <span class="c18">&nbsp;</span>
              <span class="c18 c4">robust</span>
              <span class="c18">&nbsp;and opinionated client-side</span>
              <span class="c4 c18">stack</span>
              <span class="c18">&nbsp;-</span>
              <span class="c20 c27">
                <a class="c13" href="http://yeoman.io/">http://yeoman.io/</a>
              </span>
            </li>
            <li class="c14 c3">
              <span class="c20">
                <a class="c13" href="http://documentcloud.github.com/backbone/">backbone.js</a>
              </span>
            </li>
            <li class="c14 c3">
              <span class="c20">
                <a class="c13" href="https://developers.google.com/appengine/">Google App Engine</a>
              </span>
            </li>
            <li class="c14 c3">
              <span class="c20">
                <a class="c13" href="https://developers.google.com/apis-explorer/">Google API Exploer</a>
              </span>
            </li>
          </ol>
          <p class="c3 c6">
            <span></span>
          </p>
          <p class="c3">
            <span>As always, if you have any comments please share...</span>
          </p>
         <br/><br/>
         
         <!-- Start of comments -->
         <div id="disqus_thread"></div>
          <script type="text/javascript">
            var disqus_shortname = 'greenido'; 
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        <!-- end of comments -->

            <footer>
              <div class="row">
                <div class="span2 tips coolFontBig" title="It's all yours under a Creative Commons - Have fun and let me know when/where you use it so I'll be proud of you">Ido Green 2011</div>
                <div class="span1 wooop tips" title="My twitter user @greenido">
                  <a href="https://twitter.com/#!/greenido" target="_blank" >
                    <img src="../imgs/twitter64x64.png" width="64px" height="64px"/>
                  </a>
                </div>
                <div class="span1 wooop tips" title="Little jump in Colorado">
                  <a href="http://about.me/greenido" target="_blank" >
                    <img src="../imgs/in64x64.png" width="64px" height="64px"/>
                  </a>
                </div>
                <div class="span1 wooop tips" title="My G+ spot in the world">
                  <a href="http://plus.ly/greenido" target="_blank" >
                    <img src="../imgs/g+64x64.png" width="64px" height="64px"></a>
                </div>
                <div class="span1 wooop tips" title="My blog">
                  <a href="http://greenido.wordpress.com" target="_blank">
                    <img src="../imgs/wordpress64x64.png" width="64px" height="64px"></a>
                </div>
                <div class="span3 tips" title="HTML5 Powered with Connectivity / Realtime, CSS3 / Styling, Device Access, Graphics, 3D &amp; Effects, Multimedia, Performance &amp; Integration, Semantics, and Offline &amp; Storage (2012 Feb 15) ">
                  <a href="http://www.w3.org/html/logo/" target="_blank" class='w3-logo' >
                    <img src="http://www.w3.org/html/logo/badge/html5-badge-h-connectivity-css3-device-graphics-multimedia-performance-semantics-storage.png" 
                   width="357" height="64" alt="HTML5 Powered with Connectivity / Realtime, CSS3 / Styling, Device Access, Graphics, 3D &amp; Effects, Multimedia, Performance &amp; Integration, Semantics, and Offline &amp; Storage" ></a>
                </div>
              </div>
            </footer>
          </div>

        </div>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/libs/jquery-1.7.2.min.js"><\/script>')</script>

      <script src="../js/libs/bootstrap/bootstrap.min.js"></script>

      <!-- scripts concatenated and minified via ant build script-->
      <script src="../js/libs/jquery.tipTip.minified.js"></script>
      <script src="../js/plugins.js"></script>

      <script src="http://apis.google.com/js/plusone.js"></script>

      <script>
  var _gaq=[['_setAccount','UA-27750723-1'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>

</body>
    </html>